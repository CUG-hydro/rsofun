---
title: "Hypothesis testing"
output:
  html_document: 
    fig_width: 10
    toc: yes
    toc_float: yes
---

```{r setup, include=FALSE}
library(dplyr)
library(tibble)
library(rsofun)
library(ggplot2)
```

# Read model outputs

## DBH Mortality gs-leuning 

```{r}

# LUE
ea1sa1DBHgl_out_hourly_tile    <- read.csv("~/rsofun/outputs_lm3ppa/ea1sa1DBHgl_out_hourly_tile.csv")
ea1sa1DBHgl_out_daily_tile     <- read.csv("~/rsofun/outputs_lm3ppa/ea1sa1DBHgl_out_daily_tile.csv")
ea1sa1DBHgl_out_daily_cohorts  <- read.csv("~/rsofun/outputs_lm3ppa/ea1sa1DBHgl_out_daily_cohorts.csv")
ea1sa1DBHgl_out_annual_tile    <- read.csv("~/rsofun/outputs_lm3ppa/ea1sa1DBHgl_out_annual_tile.csv")
ea1sa1DBHgl_out_annual_cohorts <- read.csv("~/rsofun/outputs_lm3ppa/ea1sa1DBHgl_out_annual_cohorts.csv")

ea2sa1DBHgl_out_hourly_tile    <- read.csv("~/rsofun/outputs_lm3ppa/ea2sa1DBHgl_out_hourly_tile.csv")
ea2sa1DBHgl_out_daily_tile     <- read.csv("~/rsofun/outputs_lm3ppa/ea2sa1DBHgl_out_daily_tile.csv")
ea2sa1DBHgl_out_daily_cohorts  <- read.csv("~/rsofun/outputs_lm3ppa/ea2sa1DBHgl_out_daily_cohorts.csv")
ea2sa1DBHgl_out_annual_tile    <- read.csv("~/rsofun/outputs_lm3ppa/ea2sa1DBHgl_out_annual_tile.csv")
ea2sa1DBHgl_out_annual_cohorts <- read.csv("~/rsofun/outputs_lm3ppa/ea2sa1DBHgl_out_annual_cohorts.csv")

ea3sa1DBHgl_out_hourly_tile    <- read.csv("~/rsofun/outputs_lm3ppa/ea3sa1DBHgl_out_hourly_tile.csv")
ea3sa1DBHgl_out_daily_tile     <- read.csv("~/rsofun/outputs_lm3ppa/ea3sa1DBHgl_out_daily_tile.csv")
ea3sa1DBHgl_out_daily_cohorts  <- read.csv("~/rsofun/outputs_lm3ppa/ea3sa1DBHgl_out_daily_cohorts.csv")
ea3sa1DBHgl_out_annual_tile    <- read.csv("~/rsofun/outputs_lm3ppa/ea3sa1DBHgl_out_annual_tile.csv")
ea3sa1DBHgl_out_annual_cohorts <- read.csv("~/rsofun/outputs_lm3ppa/ea3sa1DBHgl_out_annual_cohorts.csv")

# PAR
eb1sa1DBHgl_out_hourly_tile    <- ea1sa1DBHgl_out_hourly_tile
eb1sa1DBHgl_out_daily_tile     <- ea1sa1DBHgl_out_daily_tile
eb1sa1DBHgl_out_daily_cohorts  <- ea1sa1DBHgl_out_daily_cohorts
eb1sa1DBHgl_out_annual_tile    <- ea1sa1DBHgl_out_annual_tile
eb1sa1DBHgl_out_annual_cohorts <- ea1sa1DBHgl_out_annual_cohorts

eb2sa1DBHgl_out_hourly_tile     <- read.csv("~/rsofun/outputs_lm3ppa/eb2sa1DBHgl_out_hourly_tile.csv")
eb2sa1DBHgl_out_daily_tile      <- read.csv("~/rsofun/outputs_lm3ppa/eb2sa1DBHgl_out_daily_tile.csv")
eb2sa1DBHgl_out_daily_cohorts   <- read.csv("~/rsofun/outputs_lm3ppa/eb2sa1DBHgl_out_daily_cohorts.csv")
eb2sa1DBHgl_out_annual_tile     <- read.csv("~/rsofun/outputs_lm3ppa/eb2sa1DBHgl_out_annual_tile.csv")
eb2sa1DBHgl_out_annual_cohorts  <- read.csv("~/rsofun/outputs_lm3ppa/eb2sa1DBHgl_out_annual_cohorts.csv")

eb3sa1DBHgl_out_hourly_tile     <- read.csv("~/rsofun/outputs_lm3ppa/eb3sa1DBHgl_out_hourly_tile.csv")
eb3sa1DBHgl_out_daily_tile      <- read.csv("~/rsofun/outputs_lm3ppa/eb3sa1DBHgl_out_daily_tile.csv")
eb3sa1DBHgl_out_daily_cohorts   <- read.csv("~/rsofun/outputs_lm3ppa/eb3sa1DBHgl_out_daily_cohorts.csv")
eb3sa1DBHgl_out_annual_tile     <- read.csv("~/rsofun/outputs_lm3ppa/eb3sa1DBHgl_out_annual_tile.csv")
eb3sa1DBHgl_out_annual_cohorts  <- read.csv("~/rsofun/outputs_lm3ppa/eb3sa1DBHgl_out_annual_cohorts.csv")

# CO2
ec1sa1DBHgl_out_hourly_tile    <- ea1sa1DBHgl_out_hourly_tile
ec1sa1DBHgl_out_daily_tile     <- ea1sa1DBHgl_out_daily_tile
ec1sa1DBHgl_out_daily_cohorts  <- ea1sa1DBHgl_out_daily_cohorts
ec1sa1DBHgl_out_annual_tile    <- ea1sa1DBHgl_out_annual_tile
ec1sa1DBHgl_out_annual_cohorts <- ea1sa1DBHgl_out_annual_cohorts

ec2sa1DBHgl_out_hourly_tile     <- read.csv("~/rsofun/outputs_lm3ppa/ec2sa1DBHgl_out_hourly_tile.csv")
ec2sa1DBHgl_out_daily_tile      <- read.csv("~/rsofun/outputs_lm3ppa/ec2sa1DBHgl_out_daily_tile.csv")
ec2sa1DBHgl_out_daily_cohorts   <- read.csv("~/rsofun/outputs_lm3ppa/ec2sa1DBHgl_out_daily_cohorts.csv")
ec2sa1DBHgl_out_annual_tile     <- read.csv("~/rsofun/outputs_lm3ppa/ec2sa1DBHgl_out_annual_tile.csv")
ec2sa1DBHgl_out_annual_cohorts  <- read.csv("~/rsofun/outputs_lm3ppa/ec2sa1DBHgl_out_annual_cohorts.csv")

ec3sa1DBHgl_out_hourly_tile     <- read.csv("~/rsofun/outputs_lm3ppa/ec3sa1DBHgl_out_hourly_tile.csv")
ec3sa1DBHgl_out_daily_tile      <- read.csv("~/rsofun/outputs_lm3ppa/ec3sa1DBHgl_out_daily_tile.csv")
ec3sa1DBHgl_out_daily_cohorts   <- read.csv("~/rsofun/outputs_lm3ppa/ec3sa1DBHgl_out_daily_cohorts.csv")
ec3sa1DBHgl_out_annual_tile     <- read.csv("~/rsofun/outputs_lm3ppa/ec3sa1DBHgl_out_annual_tile.csv")
ec3sa1DBHgl_out_annual_cohorts  <- read.csv("~/rsofun/outputs_lm3ppa/ec3sa1DBHgl_out_annual_cohorts.csv")

```

## NSC Mortality gs-leuning 

```{r}

# LUE
ea1sa1NSCgl_out_hourly_tile    <- read.csv("~/rsofun/outputs_lm3ppa/ea1sa1NSCgl_out_hourly_tile.csv")
ea1sa1NSCgl_out_daily_tile     <- read.csv("~/rsofun/outputs_lm3ppa/ea1sa1NSCgl_out_daily_tile.csv")
ea1sa1NSCgl_out_daily_cohorts  <- read.csv("~/rsofun/outputs_lm3ppa/ea1sa1NSCgl_out_daily_cohorts.csv")
ea1sa1NSCgl_out_annual_tile    <- read.csv("~/rsofun/outputs_lm3ppa/ea1sa1NSCgl_out_annual_tile.csv")
ea1sa1NSCgl_out_annual_cohorts <- read.csv("~/rsofun/outputs_lm3ppa/ea1sa1NSCgl_out_annual_cohorts.csv")

ea2sa1NSCgl_out_hourly_tile    <- read.csv("~/rsofun/outputs_lm3ppa/ea2sa1NSCgl_out_hourly_tile.csv")
ea2sa1NSCgl_out_daily_tile     <- read.csv("~/rsofun/outputs_lm3ppa/ea2sa1NSCgl_out_daily_tile.csv")
ea2sa1NSCgl_out_daily_cohorts  <- read.csv("~/rsofun/outputs_lm3ppa/ea2sa1NSCgl_out_daily_cohorts.csv")
ea2sa1NSCgl_out_annual_tile    <- read.csv("~/rsofun/outputs_lm3ppa/ea2sa1NSCgl_out_annual_tile.csv")
ea2sa1NSCgl_out_annual_cohorts <- read.csv("~/rsofun/outputs_lm3ppa/ea2sa1NSCgl_out_annual_cohorts.csv")

ea3sa1NSCgl_out_hourly_tile    <- read.csv("~/rsofun/outputs_lm3ppa/ea3sa1NSCgl_out_hourly_tile.csv")
ea3sa1NSCgl_out_daily_tile     <- read.csv("~/rsofun/outputs_lm3ppa/ea3sa1NSCgl_out_daily_tile.csv")
ea3sa1NSCgl_out_daily_cohorts  <- read.csv("~/rsofun/outputs_lm3ppa/ea3sa1NSCgl_out_daily_cohorts.csv")
ea3sa1NSCgl_out_annual_tile    <- read.csv("~/rsofun/outputs_lm3ppa/ea3sa1NSCgl_out_annual_tile.csv")
ea3sa1NSCgl_out_annual_cohorts <- read.csv("~/rsofun/outputs_lm3ppa/ea3sa1NSCgl_out_annual_cohorts.csv")

# PAR
eb1sa1NSCgl_out_hourly_tile    <- ea1sa1NSCgl_out_hourly_tile
eb1sa1NSCgl_out_daily_tile     <- ea1sa1NSCgl_out_daily_tile
eb1sa1NSCgl_out_daily_cohorts  <- ea1sa1NSCgl_out_daily_cohorts
eb1sa1NSCgl_out_annual_tile    <- ea1sa1NSCgl_out_annual_tile
eb1sa1NSCgl_out_annual_cohorts <- ea1sa1NSCgl_out_annual_cohorts

eb2sa1NSCgl_out_hourly_tile     <- read.csv("~/rsofun/outputs_lm3ppa/eb2sa1NSCgl_out_hourly_tile.csv")
eb2sa1NSCgl_out_daily_tile      <- read.csv("~/rsofun/outputs_lm3ppa/eb2sa1NSCgl_out_daily_tile.csv")
eb2sa1NSCgl_out_daily_cohorts   <- read.csv("~/rsofun/outputs_lm3ppa/eb2sa1NSCgl_out_daily_cohorts.csv")
eb2sa1NSCgl_out_annual_tile     <- read.csv("~/rsofun/outputs_lm3ppa/eb2sa1NSCgl_out_annual_tile.csv")
eb2sa1NSCgl_out_annual_cohorts  <- read.csv("~/rsofun/outputs_lm3ppa/eb2sa1NSCgl_out_annual_cohorts.csv")

eb3sa1NSCgl_out_hourly_tile     <- read.csv("~/rsofun/outputs_lm3ppa/eb3sa1NSCgl_out_hourly_tile.csv")
eb3sa1NSCgl_out_daily_tile      <- read.csv("~/rsofun/outputs_lm3ppa/eb3sa1NSCgl_out_daily_tile.csv")
eb3sa1NSCgl_out_daily_cohorts   <- read.csv("~/rsofun/outputs_lm3ppa/eb3sa1NSCgl_out_daily_cohorts.csv")
eb3sa1NSCgl_out_annual_tile     <- read.csv("~/rsofun/outputs_lm3ppa/eb3sa1NSCgl_out_annual_tile.csv")
eb3sa1NSCgl_out_annual_cohorts  <- read.csv("~/rsofun/outputs_lm3ppa/eb3sa1NSCgl_out_annual_cohorts.csv")

# CO2
ec1sa1NSCgl_out_hourly_tile    <- ea1sa1NSCgl_out_hourly_tile
ec1sa1NSCgl_out_daily_tile     <- ea1sa1NSCgl_out_daily_tile
ec1sa1NSCgl_out_daily_cohorts  <- ea1sa1NSCgl_out_daily_cohorts
ec1sa1NSCgl_out_annual_tile    <- ea1sa1NSCgl_out_annual_tile
ec1sa1NSCgl_out_annual_cohorts <- ea1sa1NSCgl_out_annual_cohorts

ec2sa1NSCgl_out_hourly_tile     <- read.csv("~/rsofun/outputs_lm3ppa/ec2sa1NSCgl_out_hourly_tile.csv")
ec2sa1NSCgl_out_daily_tile      <- read.csv("~/rsofun/outputs_lm3ppa/ec2sa1NSCgl_out_daily_tile.csv")
ec2sa1NSCgl_out_daily_cohorts   <- read.csv("~/rsofun/outputs_lm3ppa/ec2sa1NSCgl_out_daily_cohorts.csv")
ec2sa1NSCgl_out_annual_tile     <- read.csv("~/rsofun/outputs_lm3ppa/ec2sa1NSCgl_out_annual_tile.csv")
ec2sa1NSCgl_out_annual_cohorts  <- read.csv("~/rsofun/outputs_lm3ppa/ec2sa1NSCgl_out_annual_cohorts.csv")

ec3sa1NSCgl_out_hourly_tile     <- read.csv("~/rsofun/outputs_lm3ppa/ec3sa1NSCgl_out_hourly_tile.csv")
ec3sa1NSCgl_out_daily_tile      <- read.csv("~/rsofun/outputs_lm3ppa/ec3sa1NSCgl_out_daily_tile.csv")
ec3sa1NSCgl_out_daily_cohorts   <- read.csv("~/rsofun/outputs_lm3ppa/ec3sa1NSCgl_out_daily_cohorts.csv")
ec3sa1NSCgl_out_annual_tile     <- read.csv("~/rsofun/outputs_lm3ppa/ec3sa1NSCgl_out_annual_tile.csv")
ec3sa1NSCgl_out_annual_cohorts  <- read.csv("~/rsofun/outputs_lm3ppa/ec3sa1NSCgl_out_annual_cohorts.csv")

```

## GR Mortality gs-leuning 

```{r}

# LUE
ea1sa1GRgl_out_hourly_tile    <- read.csv("~/rsofun/outputs_lm3ppa/ea1sa1GRgl_out_hourly_tile.csv")
ea1sa1GRgl_out_daily_tile     <- read.csv("~/rsofun/outputs_lm3ppa/ea1sa1GRgl_out_daily_tile.csv")
ea1sa1GRgl_out_daily_cohorts  <- read.csv("~/rsofun/outputs_lm3ppa/ea1sa1GRgl_out_daily_cohorts.csv")
ea1sa1GRgl_out_annual_tile    <- read.csv("~/rsofun/outputs_lm3ppa/ea1sa1GRgl_out_annual_tile.csv")
ea1sa1GRgl_out_annual_cohorts <- read.csv("~/rsofun/outputs_lm3ppa/ea1sa1GRgl_out_annual_cohorts.csv")

ea2sa1GRgl_out_hourly_tile    <- read.csv("~/rsofun/outputs_lm3ppa/ea2sa1GRgl_out_hourly_tile.csv")
ea2sa1GRgl_out_daily_tile     <- read.csv("~/rsofun/outputs_lm3ppa/ea2sa1GRgl_out_daily_tile.csv")
ea2sa1GRgl_out_daily_cohorts  <- read.csv("~/rsofun/outputs_lm3ppa/ea2sa1GRgl_out_daily_cohorts.csv")
ea2sa1GRgl_out_annual_tile    <- read.csv("~/rsofun/outputs_lm3ppa/ea2sa1GRgl_out_annual_tile.csv")
ea2sa1GRgl_out_annual_cohorts <- read.csv("~/rsofun/outputs_lm3ppa/ea2sa1GRgl_out_annual_cohorts.csv")

ea3sa1GRgl_out_hourly_tile    <- read.csv("~/rsofun/outputs_lm3ppa/ea3sa1GRgl_out_hourly_tile.csv")
ea3sa1GRgl_out_daily_tile     <- read.csv("~/rsofun/outputs_lm3ppa/ea3sa1GRgl_out_daily_tile.csv")
ea3sa1GRgl_out_daily_cohorts  <- read.csv("~/rsofun/outputs_lm3ppa/ea3sa1GRgl_out_daily_cohorts.csv")
ea3sa1GRgl_out_annual_tile    <- read.csv("~/rsofun/outputs_lm3ppa/ea3sa1GRgl_out_annual_tile.csv")
ea3sa1GRgl_out_annual_cohorts <- read.csv("~/rsofun/outputs_lm3ppa/ea3sa1GRgl_out_annual_cohorts.csv")

# PAR
eb1sa1GRgl_out_hourly_tile    <- ea1sa1GRgl_out_hourly_tile
eb1sa1GRgl_out_daily_tile     <- ea1sa1GRgl_out_daily_tile
eb1sa1GRgl_out_daily_cohorts  <- ea1sa1GRgl_out_daily_cohorts
eb1sa1GRgl_out_annual_tile    <- ea1sa1GRgl_out_annual_tile
eb1sa1GRgl_out_annual_cohorts <- ea1sa1GRgl_out_annual_cohorts

eb2sa1GRgl_out_hourly_tile     <- read.csv("~/rsofun/outputs_lm3ppa/eb2sa1GRgl_out_hourly_tile.csv")
eb2sa1GRgl_out_daily_tile      <- read.csv("~/rsofun/outputs_lm3ppa/eb2sa1GRgl_out_daily_tile.csv")
eb2sa1GRgl_out_daily_cohorts   <- read.csv("~/rsofun/outputs_lm3ppa/eb2sa1GRgl_out_daily_cohorts.csv")
eb2sa1GRgl_out_annual_tile     <- read.csv("~/rsofun/outputs_lm3ppa/eb2sa1GRgl_out_annual_tile.csv")
eb2sa1GRgl_out_annual_cohorts  <- read.csv("~/rsofun/outputs_lm3ppa/eb2sa1GRgl_out_annual_cohorts.csv")

eb3sa1GRgl_out_hourly_tile     <- read.csv("~/rsofun/outputs_lm3ppa/eb3sa1GRgl_out_hourly_tile.csv")
eb3sa1GRgl_out_daily_tile      <- read.csv("~/rsofun/outputs_lm3ppa/eb3sa1GRgl_out_daily_tile.csv")
eb3sa1GRgl_out_daily_cohorts   <- read.csv("~/rsofun/outputs_lm3ppa/eb3sa1GRgl_out_daily_cohorts.csv")
eb3sa1GRgl_out_annual_tile     <- read.csv("~/rsofun/outputs_lm3ppa/eb3sa1GRgl_out_annual_tile.csv")
eb3sa1GRgl_out_annual_cohorts  <- read.csv("~/rsofun/outputs_lm3ppa/eb3sa1GRgl_out_annual_cohorts.csv")

```

## CST Mortality gs-leuning 

```{r}

# LUE
ea1sa1CSTgl_out_hourly_tile    <- read.csv("~/rsofun/outputs_lm3ppa/ea1sa1CSTgl_out_hourly_tile.csv")
ea1sa1CSTgl_out_daily_tile     <- read.csv("~/rsofun/outputs_lm3ppa/ea1sa1CSTgl_out_daily_tile.csv")
ea1sa1CSTgl_out_daily_cohorts  <- read.csv("~/rsofun/outputs_lm3ppa/ea1sa1CSTgl_out_daily_cohorts.csv")
ea1sa1CSTgl_out_annual_tile    <- read.csv("~/rsofun/outputs_lm3ppa/ea1sa1CSTgl_out_annual_tile.csv")
ea1sa1CSTgl_out_annual_cohorts <- read.csv("~/rsofun/outputs_lm3ppa/ea1sa1CSTgl_out_annual_cohorts.csv")

ea2sa1CSTgl_out_hourly_tile    <- read.csv("~/rsofun/outputs_lm3ppa/ea2sa1CSTgl_out_hourly_tile.csv")
ea2sa1CSTgl_out_daily_tile     <- read.csv("~/rsofun/outputs_lm3ppa/ea2sa1CSTgl_out_daily_tile.csv")
ea2sa1CSTgl_out_daily_cohorts  <- read.csv("~/rsofun/outputs_lm3ppa/ea2sa1CSTgl_out_daily_cohorts.csv")
ea2sa1CSTgl_out_annual_tile    <- read.csv("~/rsofun/outputs_lm3ppa/ea2sa1CSTgl_out_annual_tile.csv")
ea2sa1CSTgl_out_annual_cohorts <- read.csv("~/rsofun/outputs_lm3ppa/ea2sa1CSTgl_out_annual_cohorts.csv")

ea3sa1CSTgl_out_hourly_tile    <- read.csv("~/rsofun/outputs_lm3ppa/ea3sa1CSTgl_out_hourly_tile.csv")
ea3sa1CSTgl_out_daily_tile     <- read.csv("~/rsofun/outputs_lm3ppa/ea3sa1CSTgl_out_daily_tile.csv")
ea3sa1CSTgl_out_daily_cohorts  <- read.csv("~/rsofun/outputs_lm3ppa/ea3sa1CSTgl_out_daily_cohorts.csv")
ea3sa1CSTgl_out_annual_tile    <- read.csv("~/rsofun/outputs_lm3ppa/ea3sa1CSTgl_out_annual_tile.csv")
ea3sa1CSTgl_out_annual_cohorts <- read.csv("~/rsofun/outputs_lm3ppa/ea3sa1CSTgl_out_annual_cohorts.csv")

# PAR
eb1sa1CSTgl_out_hourly_tile    <- ea1sa1CSTgl_out_hourly_tile
eb1sa1CSTgl_out_daily_tile     <- ea1sa1CSTgl_out_daily_tile
eb1sa1CSTgl_out_daily_cohorts  <- ea1sa1CSTgl_out_daily_cohorts
eb1sa1CSTgl_out_annual_tile    <- ea1sa1CSTgl_out_annual_tile
eb1sa1CSTgl_out_annual_cohorts <- ea1sa1CSTgl_out_annual_cohorts

eb2sa1CSTgl_out_hourly_tile     <- read.csv("~/rsofun/outputs_lm3ppa/eb2sa1CSTgl_out_hourly_tile.csv")
eb2sa1CSTgl_out_daily_tile      <- read.csv("~/rsofun/outputs_lm3ppa/eb2sa1CSTgl_out_daily_tile.csv")
eb2sa1CSTgl_out_daily_cohorts   <- read.csv("~/rsofun/outputs_lm3ppa/eb2sa1CSTgl_out_daily_cohorts.csv")
eb2sa1CSTgl_out_annual_tile     <- read.csv("~/rsofun/outputs_lm3ppa/eb2sa1CSTgl_out_annual_tile.csv")
eb2sa1CSTgl_out_annual_cohorts  <- read.csv("~/rsofun/outputs_lm3ppa/eb2sa1CSTgl_out_annual_cohorts.csv")

eb3sa1CSTgl_out_hourly_tile     <- read.csv("~/rsofun/outputs_lm3ppa/eb3sa1CSTgl_out_hourly_tile.csv")
eb3sa1CSTgl_out_daily_tile      <- read.csv("~/rsofun/outputs_lm3ppa/eb3sa1CSTgl_out_daily_tile.csv")
eb3sa1CSTgl_out_daily_cohorts   <- read.csv("~/rsofun/outputs_lm3ppa/eb3sa1CSTgl_out_daily_cohorts.csv")
eb3sa1CSTgl_out_annual_tile     <- read.csv("~/rsofun/outputs_lm3ppa/eb3sa1CSTgl_out_annual_tile.csv")
eb3sa1CSTgl_out_annual_cohorts  <- read.csv("~/rsofun/outputs_lm3ppa/eb3sa1CSTgl_out_annual_cohorts.csv")

```

# Creating dataframes for annual tile outputs

## DBH Mortality gs-leuning 

```{r}
# LUE
ea1sa1DBHgl_out_annual_tile <- ea1sa1DBHgl_out_annual_tile %>% mutate(Mortality = rep("DBH", dim(ea1sa1DBHgl_out_annual_tile)[1])) %>% mutate(LevelLUE = rep(1, dim(ea1sa1DBHgl_out_annual_tile)[1])) %>% mutate(LevelWD = rep(1, dim(ea1sa1DBHgl_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)

ea2sa1DBHgl_out_annual_tile <- ea2sa1DBHgl_out_annual_tile %>% mutate(Mortality = rep("DBH", dim(ea2sa1DBHgl_out_annual_tile)[1])) %>% mutate(LevelLUE = rep(2, dim(ea2sa1DBHgl_out_annual_tile)[1])) %>% mutate(LevelWD = rep(1, dim(ea2sa1DBHgl_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)

ea3sa1DBHgl_out_annual_tile <- ea3sa1DBHgl_out_annual_tile %>% mutate(Mortality = rep("DBH", dim(ea3sa1DBHgl_out_annual_tile)[1])) %>% mutate(LevelLUE = rep(3, dim(ea3sa1DBHgl_out_annual_tile)[1])) %>% mutate(LevelWD = rep(1, dim(ea3sa1DBHgl_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)

# PAR
eb1sa1DBHgl_out_annual_tile <- eb1sa1DBHgl_out_annual_tile %>% mutate(Mortality = rep("DBH", dim(eb1sa1DBHgl_out_annual_tile)[1])) %>% mutate(LevelLUE = rep(1, dim(eb1sa1DBHgl_out_annual_tile)[1])) %>% mutate(LevelWD = rep(1, dim(eb1sa1DBHgl_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)

eb2sa1DBHgl_out_annual_tile <- eb2sa1DBHgl_out_annual_tile %>% mutate(Mortality = rep("DBH", dim(eb2sa1DBHgl_out_annual_tile)[1])) %>% mutate(LevelLUE = rep(2, dim(eb2sa1DBHgl_out_annual_tile)[1])) %>% mutate(LevelWD = rep(1, dim(eb2sa1DBHgl_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)

eb3sa1DBHgl_out_annual_tile <- eb3sa1DBHgl_out_annual_tile %>% mutate(Mortality = rep("DBH", dim(eb3sa1DBHgl_out_annual_tile)[1])) %>% mutate(LevelLUE = rep(3, dim(eb3sa1DBHgl_out_annual_tile)[1])) %>% mutate(LevelWD = rep(1, dim(eb3sa1DBHgl_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)

# CO2
ec1sa1DBHgl_out_annual_tile <- ec1sa1DBHgl_out_annual_tile %>% mutate(Mortality = rep("DBH", dim(ec1sa1DBHgl_out_annual_tile)[1])) %>% mutate(LevelCO2 = rep(1, dim(ec1sa1DBHgl_out_annual_tile)[1])) %>% mutate(LevelWD = rep(1, dim(ec1sa1DBHgl_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)

ec2sa1DBHgl_out_annual_tile <- ec2sa1DBHgl_out_annual_tile %>% mutate(Mortality = rep("DBH", dim(ec2sa1DBHgl_out_annual_tile)[1])) %>% mutate(LevelCO2 = rep(2, dim(ec2sa1DBHgl_out_annual_tile)[1])) %>% mutate(LevelWD = rep(1, dim(ec2sa1DBHgl_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)

ec3sa1DBHgl_out_annual_tile <- ec3sa1DBHgl_out_annual_tile %>% mutate(Mortality = rep("DBH", dim(ec3sa1DBHgl_out_annual_tile)[1])) %>% mutate(LevelCO2 = rep(3, dim(ec3sa1DBHgl_out_annual_tile)[1])) %>% mutate(LevelWD = rep(1, dim(ec3sa1DBHgl_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)

```

## NSC Mortality gs-leuning

```{r}
# LUE
ea1sa1NSCgl_out_annual_tile <- ea1sa1NSCgl_out_annual_tile %>% mutate(Mortality = rep("NSC", dim(ea1sa1NSCgl_out_annual_tile)[1])) %>% mutate(LevelLUE = rep(1, dim(ea1sa1NSCgl_out_annual_tile)[1])) %>% mutate(LevelWD = rep(1, dim(ea1sa1NSCgl_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)

ea2sa1NSCgl_out_annual_tile <- ea2sa1NSCgl_out_annual_tile %>% mutate(Mortality = rep("NSC", dim(ea2sa1NSCgl_out_annual_tile)[1])) %>% mutate(LevelLUE = rep(2, dim(ea2sa1NSCgl_out_annual_tile)[1])) %>% mutate(LevelWD = rep(1, dim(ea2sa1NSCgl_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)

ea3sa1NSCgl_out_annual_tile <- ea3sa1NSCgl_out_annual_tile %>% mutate(Mortality = rep("NSC", dim(ea3sa1NSCgl_out_annual_tile)[1])) %>% mutate(LevelLUE = rep(3, dim(ea3sa1NSCgl_out_annual_tile)[1])) %>% mutate(LevelWD = rep(1, dim(ea3sa1NSCgl_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)

# PAR
eb1sa1NSCgl_out_annual_tile <- eb1sa1NSCgl_out_annual_tile %>% mutate(Mortality = rep("NSC", dim(eb1sa1NSCgl_out_annual_tile)[1])) %>% mutate(LevelLUE = rep(1, dim(eb1sa1NSCgl_out_annual_tile)[1])) %>% mutate(LevelWD = rep(1, dim(eb1sa1NSCgl_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)

eb2sa1NSCgl_out_annual_tile <- eb2sa1NSCgl_out_annual_tile %>% mutate(Mortality = rep("NSC", dim(eb2sa1NSCgl_out_annual_tile)[1])) %>% mutate(LevelLUE = rep(2, dim(eb2sa1NSCgl_out_annual_tile)[1])) %>% mutate(LevelWD = rep(1, dim(eb2sa1NSCgl_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)

eb3sa1NSCgl_out_annual_tile <- eb3sa1NSCgl_out_annual_tile %>% mutate(Mortality = rep("NSC", dim(eb3sa1NSCgl_out_annual_tile)[1])) %>% mutate(LevelLUE = rep(3, dim(eb3sa1NSCgl_out_annual_tile)[1])) %>% mutate(LevelWD = rep(1, dim(eb3sa1NSCgl_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)
```

## GR Mortality gs-leuning

```{r}
# LUE
ea1sa1GRgl_out_annual_tile <- ea1sa1GRgl_out_annual_tile %>% mutate(Mortality = rep("GR", dim(ea1sa1GRgl_out_annual_tile)[1])) %>% mutate(LevelLUE = rep(1, dim(ea1sa1GRgl_out_annual_tile)[1])) %>% mutate(LevelWD = rep(1, dim(ea1sa1GRgl_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)

ea2sa1GRgl_out_annual_tile <- ea2sa1GRgl_out_annual_tile %>% mutate(Mortality = rep("GR", dim(ea2sa1GRgl_out_annual_tile)[1])) %>% mutate(LevelLUE = rep(2, dim(ea2sa1GRgl_out_annual_tile)[1])) %>% mutate(LevelWD = rep(1, dim(ea2sa1GRgl_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)

ea3sa1GRgl_out_annual_tile <- ea3sa1GRgl_out_annual_tile %>% mutate(Mortality = rep("GR", dim(ea3sa1GRgl_out_annual_tile)[1])) %>% mutate(LevelLUE = rep(3, dim(ea3sa1GRgl_out_annual_tile)[1])) %>% mutate(LevelWD = rep(1, dim(ea3sa1GRgl_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)

# PAR
eb1sa1GRgl_out_annual_tile <- eb1sa1GRgl_out_annual_tile %>% mutate(Mortality = rep("GR", dim(eb1sa1GRgl_out_annual_tile)[1])) %>% mutate(LevelLUE = rep(1, dim(eb1sa1GRgl_out_annual_tile)[1])) %>% mutate(LevelWD = rep(1, dim(eb1sa1GRgl_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)

eb2sa1GRgl_out_annual_tile <- eb2sa1GRgl_out_annual_tile %>% mutate(Mortality = rep("GR", dim(eb2sa1GRgl_out_annual_tile)[1])) %>% mutate(LevelLUE = rep(2, dim(eb2sa1GRgl_out_annual_tile)[1])) %>% mutate(LevelWD = rep(1, dim(eb2sa1GRgl_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)

eb3sa1GRgl_out_annual_tile <- eb3sa1GRgl_out_annual_tile %>% mutate(Mortality = rep("GR", dim(eb3sa1GRgl_out_annual_tile)[1])) %>% mutate(LevelLUE = rep(3, dim(eb3sa1GRgl_out_annual_tile)[1])) %>% mutate(LevelWD = rep(1, dim(eb3sa1GRgl_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)
```

## CST Mortality gs-leuning

```{r}
# LUE
ea1sa1CSTgl_out_annual_tile <- ea1sa1CSTgl_out_annual_tile %>% mutate(Mortality = rep("CST", dim(ea1sa1CSTgl_out_annual_tile)[1])) %>% mutate(LevelLUE = rep(1, dim(ea1sa1CSTgl_out_annual_tile)[1])) %>% mutate(LevelWD = rep(1, dim(ea1sa1CSTgl_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)

ea2sa1CSTgl_out_annual_tile <- ea2sa1CSTgl_out_annual_tile %>% mutate(Mortality = rep("CST", dim(ea2sa1CSTgl_out_annual_tile)[1])) %>% mutate(LevelLUE = rep(2, dim(ea2sa1CSTgl_out_annual_tile)[1])) %>% mutate(LevelWD = rep(1, dim(ea2sa1CSTgl_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)

ea3sa1CSTgl_out_annual_tile <- ea3sa1CSTgl_out_annual_tile %>% mutate(Mortality = rep("CST", dim(ea3sa1CSTgl_out_annual_tile)[1])) %>% mutate(LevelLUE = rep(3, dim(ea3sa1CSTgl_out_annual_tile)[1])) %>% mutate(LevelWD = rep(1, dim(ea3sa1CSTgl_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)

# PAR
eb1sa1CSTgl_out_annual_tile <- eb1sa1CSTgl_out_annual_tile %>% mutate(Mortality = rep("CST", dim(eb1sa1CSTgl_out_annual_tile)[1])) %>% mutate(LevelLUE = rep(1, dim(eb1sa1CSTgl_out_annual_tile)[1])) %>% mutate(LevelWD = rep(1, dim(eb1sa1CSTgl_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)

eb2sa1CSTgl_out_annual_tile <- eb2sa1CSTgl_out_annual_tile %>% mutate(Mortality = rep("CST", dim(eb2sa1CSTgl_out_annual_tile)[1])) %>% mutate(LevelLUE = rep(2, dim(eb2sa1CSTgl_out_annual_tile)[1])) %>% mutate(LevelWD = rep(1, dim(eb2sa1CSTgl_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)

eb3sa1CSTgl_out_annual_tile <- eb3sa1CSTgl_out_annual_tile %>% mutate(Mortality = rep("CST", dim(eb3sa1CSTgl_out_annual_tile)[1])) %>% mutate(LevelLUE = rep(3, dim(eb3sa1CSTgl_out_annual_tile)[1])) %>% mutate(LevelWD = rep(1, dim(eb3sa1CSTgl_out_annual_tile)[1])) %>% mutate(MaxVolume_MaxAge = MaxVolume/MaxAge) %>% mutate(MaxDBH_MaxAge = MaxDBH/MaxAge) %>% mutate(A_Biomass=WoodC + leafC) %>% mutate(A_NPP=NPPL + NPPW)
```

# Exploring relationships and plotting

## LUE levels

### Stand develop: Stand biomass vs. time

From annual_tile_output: PlanC (Biomass)
Level of LUE (mol/s/m2)

```{r}
# Mortality as a function of DBH
# Biomass changes in LUE with WD level 1
BioDBH <- ggplot() + 
  geom_line(data=ea1sa1DBHgl_out_annual_tile, aes(x=year, y=plantC, color='Control')) + 
  geom_line(data=ea2sa1DBHgl_out_annual_tile, aes(x=year, y=plantC, color='+15%')) +
  geom_line(data=ea3sa1DBHgl_out_annual_tile, aes(x=year, y=plantC, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#619CFF", "#00BA38"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom",
        axis.text = element_text(size = 10),axis.title = element_text(size = 11),
        legend.text = element_text(size = 10),legend.title = element_text(size = 11),
        plot.title = element_text(size = 11)) + 
  labs(title= "Tree mortality as a function of size")

# Mortality as a function of C starvation
# Biomass changes in LUE with WD level 1
BioNSC <- ggplot() + 
  geom_line(data=ea1sa1NSCgl_out_annual_tile, aes(x=year, y=plantC, color='Control')) + 
  geom_line(data=ea2sa1NSCgl_out_annual_tile, aes(x=year, y=plantC, color='+15%')) +
  geom_line(data=ea3sa1NSCgl_out_annual_tile, aes(x=year, y=plantC, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#619CFF", "#00BA38"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom",
        axis.text = element_text(size = 10),axis.title = element_text(size = 11),
        legend.text = element_text(size = 10),legend.title = element_text(size = 11),
        plot.title = element_text(size = 11)) + 
  labs(title= "Tree mortality as a function of C starvation")

# Mortality as a function of Growth rate
# Biomass changes in LUE with WD level 1
BioGR <- ggplot() + 
  geom_line(data=ea1sa1GRgl_out_annual_tile, aes(x=year, y=plantC, color='Control')) + 
  geom_line(data=ea2sa1GRgl_out_annual_tile, aes(x=year, y=plantC, color='+15%')) +
  geom_line(data=ea3sa1GRgl_out_annual_tile, aes(x=year, y=plantC, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#619CFF", "#00BA38"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom",
        axis.text = element_text(size = 10),axis.title = element_text(size = 11),
        legend.text = element_text(size = 10),legend.title = element_text(size = 11),
        plot.title = element_text(size = 11)) + 
  labs(title= "Tree mortality as a function of growth rate") 

# Mortality as a function of Self-thinning
# Biomass changes in LUE with WD level 1
ggplot() + 
  geom_line(data=ea1sa1CSTgl_out_annual_tile, aes(x=year, y=plantC, color='Control')) + 
  geom_line(data=ea2sa1CSTgl_out_annual_tile, aes(x=year, y=plantC, color='+15%')) +
  geom_line(data=ea3sa1CSTgl_out_annual_tile, aes(x=year, y=plantC, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#619CFF", "#00BA38"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Function of Constant Self-thinning gs-Leuning") 

```
#### Arrange plots

```{r, include=F, eval=T,fig.height=4,fig.width=10}
library(ggpubr) # ggarrange
ggarrange(BioDBH,BioNSC,BioGR, ncol = 3, nrow = 1, common.legend = T,legend="right")
ggsave("plotBio.tiff", width = 10, height = 3, device='tiff', dpi=300)

```


### Arrange figures
```{r, fig.width = 10, fig.height = 4}

## All mortality form with facet_wrap
data1 <- rbind(ea1sa1DBHgl_out_annual_tile, ea2sa1DBHgl_out_annual_tile, ea3sa1DBHgl_out_annual_tile,
               ea1sa1NSCgl_out_annual_tile, ea2sa1NSCgl_out_annual_tile, ea3sa1NSCgl_out_annual_tile,
               ea1sa1GRgl_out_annual_tile,  ea2sa1GRgl_out_annual_tile,  ea3sa1GRgl_out_annual_tile)

data1$Mortality <- factor(data1$Mortality, levels = c("DBH", "NSC", "GR"),
                  labels = c("Tree mortality as function of size", "Tree mortality as function of C starvation", "Tree mortality as function of growth rate"))

ggplot(data=data1) +
  geom_line(aes(x=year, y=plantC,color=as.factor(LevelLUE))) + facet_wrap(~ Mortality, ncol=3)+
  scale_color_manual(labels = c("Low", "Medium", "High"), values = c("#F8766D" ,"#619CFF", "#00BA38"))+
  labs(col = "Growth rate",x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "right",legend.text = element_text(size=10),legend.title = element_text(size=10))

ggsave("plotBio.tiff", width = 9.5, height = 3, device='tiff', dpi=300)


```

### GPP vs. time

From annual_tile_output: GPP 
LUE (mol/s/m2)

```{r}
# Mortality as a function of DBH
# Biomass changes in LUE with WD level 1
ggplot() + 
  geom_line(data=ea1sa1DBHgl_out_annual_tile, aes(x=year, y=GPP, color='Control')) + 
  geom_line(data=ea2sa1DBHgl_out_annual_tile, aes(x=year, y=GPP, color='+15%')) +
  geom_line(data=ea3sa1DBHgl_out_annual_tile, aes(x=year, y=GPP, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = expression(paste("GPP (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Function of DBH gs-Leuning") + scale_y_continuous(limits = c(0,3.5))

# Mortality as a function of C starvation
# Biomass changes in LUE with WD level 1
ggplot() + 
  geom_line(data=ea1sa1NSCgl_out_annual_tile, aes(x=year, y=GPP, color='Control')) + 
  geom_line(data=ea2sa1NSCgl_out_annual_tile, aes(x=year, y=GPP, color='+15%')) +
  geom_line(data=ea3sa1NSCgl_out_annual_tile, aes(x=year, y=GPP, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = expression(paste("GPP (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Function of C starvation gs-Leuning") 

# Mortality as a function of Growth rate
# Biomass changes in LUE with WD level 1
ggplot() + 
  geom_line(data=ea1sa1GRgl_out_annual_tile, aes(x=year, y=GPP, color='Control')) + 
  geom_line(data=ea2sa1GRgl_out_annual_tile, aes(x=year, y=GPP, color='+15%')) +
  geom_line(data=ea3sa1GRgl_out_annual_tile, aes(x=year, y=GPP, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = expression(paste("GPP (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Function of Growth rate gs-Leuning") 

# Mortality as a function of Constant Self-thinning
# Biomass changes in LUE with WD level 1
ggplot() + 
  geom_line(data=ea1sa1CSTgl_out_annual_tile, aes(x=year, y=GPP, color='Control')) + 
  geom_line(data=ea2sa1CSTgl_out_annual_tile, aes(x=year, y=GPP, color='+15%')) +
  geom_line(data=ea3sa1CSTgl_out_annual_tile, aes(x=year, y=GPP, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = expression(paste("GPP (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Function of Constant Self-thinning gs-Leuning") 

```

### Crown Area Index vs. time

```{r}
ggplot() + 
  geom_line(data=ea1sa1DBHgl_out_annual_tile, aes(x=year, y=CAI, color='Control')) + 
  geom_line(data=ea2sa1DBHgl_out_annual_tile, aes(x=year, y=CAI, color='+15%')) +
  geom_line(data=ea3sa1DBHgl_out_annual_tile, aes(x=year, y=CAI, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x="Year", y="CAI")+
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Mortality formulation DBH")

```

### Self-thinning relationship

From annual_tile_output: QMD and Density12
LUE (mol/s/m2)

```{r, include=T, eval=T,fig.height=6,fig.width=8}

# Mortality as a function of DBH
# Biomass changes in LUE with WD level 1

## Figure opt 1
ggplot() + 
  geom_point(data=subset(ea1sa1DBHgl_out_annual_tile,year>=100), aes(x=log(QMD), y=log(Density12), color='Control')) + 
  geom_point(data=subset(ea2sa1DBHgl_out_annual_tile,year>=100), aes(x=log(QMD), y=log(Density12), color='+15%')) +
  geom_point(data=subset(ea3sa1DBHgl_out_annual_tile,year>=100), aes(x=log(QMD), y=log(Density12), color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#619CFF","#00BA38"))+
  labs(col = "Level of LUE", x = "Ln(QMD)", y = "Ln(N)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Function of DBH") + 
  scale_x_continuous(limits = c(3.5,4.25)) + 
  scale_y_continuous(limits = c(4.8,6))

## Figure opt 2 With geom_smooth
data1 <- rbind(ea1sa1DBHgl_out_annual_tile, ea2sa1DBHgl_out_annual_tile, ea3sa1DBHgl_out_annual_tile)
figure1 <- ggplot() + 
  geom_point(data=subset(data1, year>=500), aes(x=log(QMD), y=log(Density12), color=as.factor(LevelLUE))) +
  geom_smooth(data=subset(data1, year>=500), aes(x=log(QMD), y=log(Density12), color=as.factor(LevelLUE)),method = "lm",fullrange = T) +
  scale_color_manual(labels = c("Control","+15%", "+30%"),values = c("#F8766D" ,"#619CFF","#00BA38"))+
  labs(col = "Levels of Light Use Efficiency", x = "Quadratic Mean Diameter (QMD)", y = "Stand density (N)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom",
                     legend.text = element_text(size=10),legend.title = element_text(size=10)) + 
  #ggtitle("Mortality as a function of DBH") + 
  scale_x_continuous(limits = c(3.5,4),breaks = seq(3.5,4,0.1)) + 
  scale_y_continuous(limits = c(4.9,6.2),breaks = seq(5,6,0.2))
ggsave("figure1.1.tiff", width = 5, height = 4, device='tiff', dpi=300)

## Figure opt 3 With geom_abline
ggplot() + 
  geom_point(data=ea1sa1DBHgl_out_annual_tile[100:1804,], aes(x=log(QMD), y=log(Density12), color='Control')) + 
  geom_point(data=ea2sa1DBHgl_out_annual_tile[100:1804,], aes(x=log(QMD), y=log(Density12), color='+15%')) +
  geom_point(data=ea3sa1DBHgl_out_annual_tile[100:1804,], aes(x=log(QMD), y=log(Density12), color='+30%')) +
  scale_color_manual("Levels of LUE at WD 1", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D"  ,"#619CFF","#00BA38"))+
  scale_x_continuous(limits = c(3.5,4.25)) + 
  scale_y_continuous(limits = c(4.8,6),breaks = seq(5,6,0.25)) +
  labs(x = "Ln(QMD)", y = "Ln(N)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = ea1sa1DBHgl_out_annual_tile[100:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = ea1sa1DBHgl_out_annual_tile[100:1804,]))[2], color="#F8766D") +
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = ea2sa1DBHgl_out_annual_tile[100:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = ea2sa1DBHgl_out_annual_tile[100:1804,]))[2], color="#619CFF") +
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = ea3sa1DBHgl_out_annual_tile[100:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = ea3sa1DBHgl_out_annual_tile[100:1804,]))[2], color="#00BA38")

```

From annual_tile_output: QMD and Density12
LUE (mol/s/m2)

```{r, include=T, eval=T,fig.height=6,fig.width=8}

# Mortality as a function of DBH

data1 <- rbind(ea1sa1DBHgl_out_annual_tile, ea2sa1DBHgl_out_annual_tile, ea3sa1DBHgl_out_annual_tile)
ggplot() + 
  geom_point(data=subset(data1, year>=500), aes(x=log(QMD), y=log(Density12), color=as.factor(LevelLUE)),alpha=1) + 
  geom_smooth(data=subset(data1, year>=500), aes(x=log(QMD), y=log(Density12), color=as.factor(LevelLUE)),method = "lm",fullrange = T) +
  scale_color_manual(labels = c("Low","Medium", "High"),values = c("#F8766D" ,"#619CFF","#00BA38"))+
  labs(col = "Growth rate", x = "Quadratic Mean Diameter (QMD)", y = "Stand density (N)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") + 
  ggtitle("") + 
  scale_x_continuous(limits = c(3.5,4),breaks = seq(3.5,4,0.1)) + 
  scale_y_continuous(limits = c(4.75,6.25),breaks = seq(4.75,6.25,0.25))

ggsave("figure1.2.tiff", width = 5, height = 5, device='tiff', dpi=300)

# Mortality as a function of NSC

data1 <- rbind(ea1sa1NSCgl_out_annual_tile, ea2sa1NSCgl_out_annual_tile, ea3sa1NSCgl_out_annual_tile)
ggplot() + 
  geom_point(data=subset(data1, year>=500), aes(x=log(QMD), y=log(Density12), color=as.factor(LevelLUE))) +
  geom_smooth(data=subset(data1, year>=500), aes(x=log(QMD), y=log(Density12), color=as.factor(LevelLUE)),method = "lm",fullrange = T) +
  scale_color_manual(labels = c("Control","+15%", "+30%"),values = c("#F8766D" ,"#619CFF","#00BA38"))+
  labs(col = "Level of LUE", x = "Quadratic Mean Diameter (QMD)", y = "Stand density (N)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") + 
  ggtitle("Mortality as a function of NSC") + 
  scale_x_continuous(limits = c(2.6,3.6)) + 
  scale_y_continuous(limits = c(3.8,8.2))

# Mortality as a function of GR

data1 <- rbind(ea1sa1GRgl_out_annual_tile, ea2sa1GRgl_out_annual_tile, ea3sa1GRgl_out_annual_tile)
ggplot() + 
  geom_point(data=subset(data1, year>=500), aes(x=log(QMD), y=log(Density12), color=as.factor(LevelLUE))) +
  geom_smooth(data=subset(data1, year>=500), aes(x=log(QMD), y=log(Density12), color=as.factor(LevelLUE)),method = "lm",fullrange = T) +
  scale_color_manual(labels = c("Control","+15%", "+30%"),values = c("#F8766D" ,"#619CFF","#00BA38"))+
  labs(col = "Level of LUE", x = "Quadratic Mean Diameter (QMD)", y = "Stand density (N)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") + 
  ggtitle("Mortality as a function of GR") 


# Mortality as a function of CST

## Figure opt 1
ggplot() + 
  geom_point(data=subset(ea1sa1CSTgl_out_annual_tile,year>=500), aes(x=log(DBH), y=log(Density), color='Control')) + 
  geom_point(data=subset(ea2sa1CSTgl_out_annual_tile,year>=500), aes(x=log(DBH), y=log(Density), color='+15%')) +
  geom_point(data=subset(ea3sa1CSTgl_out_annual_tile,year>=500), aes(x=log(DBH), y=log(Density), color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#619CFF","#00BA38"))+
  labs(col = "Level of LUE", x = "Ln(QMD)", y = "Ln(N)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Function of DBH") + 
  scale_x_continuous(limits = c(3.5,4.25)) + 
  scale_y_continuous(limits = c(4.8,6))


data1 <- rbind(ea1sa1CSTgl_out_annual_tile, ea2sa1CSTgl_out_annual_tile, ea3sa1CSTgl_out_annual_tile)
ggplot() + 
  geom_point(data=subset(data1, year>=38), aes(x=log(QMD), y=log(Density12), color=as.factor(LevelLUE))) +
  geom_smooth(data=subset(data1, year>=25), aes(x=log(QMD), y=log(Density12), color=as.factor(LevelLUE)),method = "lm",fullrange = T) +
  scale_color_manual(labels = c("Control","+15%", "+30%"),values = c("#F8766D" ,"#619CFF","#00BA38"))+
  labs(col = "Level of LUE", x = "Quadratic Mean Diameter (QMD)", y = "Stand density (N)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") + 
  ggtitle("Mortality as a function of GR") 

```

### Arrange figures
```{r, fig.width = 10, fig.height = 4}

## All mortality form with facet_wrap
data1 <- rbind(ea1sa1DBHgl_out_annual_tile, ea2sa1DBHgl_out_annual_tile, ea3sa1DBHgl_out_annual_tile,
               ea1sa1NSCgl_out_annual_tile, ea2sa1NSCgl_out_annual_tile, ea3sa1NSCgl_out_annual_tile,
               ea1sa1GRgl_out_annual_tile,  ea2sa1GRgl_out_annual_tile,  ea3sa1GRgl_out_annual_tile)

data1$Mortality <- factor(data1$Mortality, levels = c("DBH", "NSC", "GR"),
                  labels = c("Tree mortality as function of size", "Tree mortality as function of C starvation", "Tree mortality as function of growth rate"))

ggplot(data=subset(data1, year>=500)) +
  geom_smooth(data=subset(data1, year>=500), aes(x=log(QMD), y=log(Density12), color=as.factor(LevelLUE)),method = "lm",fullrange = T) +
  geom_point(aes(x=log(QMD), y=log(Density12), color=as.factor(LevelLUE)),size=.8) + 
  facet_wrap(~ Mortality, ncol=3, scales = "free")+
  scale_color_manual(labels = c("Low", "Medium", "High"), values = c("#F8766D" ,"#619CFF", "#00BA38"))+
  labs(col = "Growth rate", x = "Quadratic Mean Diameter (QMD)", y = "Stand density (N)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "right",legend.text = element_text(size=10),legend.title = element_text(size=10))

ggsave("plotST.tiff", width = 9.5, height = 3, device='tiff', dpi=300)

```

### B* vs. initial slope of (B vs. t) 

From annual_tile_output: PlantC (Biomass)

```{r, fig.width = 8, fig.height = 6}

# Mortality DBH
ggplot() + 
  geom_line(data=ea1sa1DBHgl_out_annual_tile[1:150,], aes(x=year, y=plantC, color='Control')) + 
  geom_line(data=ea2sa1DBHgl_out_annual_tile[1:150,], aes(x=year, y=plantC, color='+15%')) +
  geom_line(data=ea3sa1DBHgl_out_annual_tile[1:150,], aes(x=year, y=plantC, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

ggplot() + 
  geom_line(data=ea1sa1DBHgl_out_annual_tile[1300:1804,], aes(x=year, y=plantC, color='Control')) + 
  geom_line(data=ea2sa1DBHgl_out_annual_tile[1300:1804,], aes(x=year, y=plantC, color='+15%')) +
  geom_line(data=ea3sa1DBHgl_out_annual_tile[1300:1804,], aes(x=year, y=plantC, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

slope1 <- summary(lm(plantC ~ year, ea1sa1DBHgl_out_annual_tile[1:150,]))$coefficients[2,1]
sd1 <- summary(lm(plantC ~ year, ea1sa1DBHgl_out_annual_tile[1:150,]))$coefficients[2,2]
slope2 <- summary(lm(plantC ~ year, ea2sa1DBHgl_out_annual_tile[1:150,]))$coefficients[2,1]
sd2 <- summary(lm(plantC ~ year, ea2sa1DBHgl_out_annual_tile[1:150,]))$coefficients[2,2]
slope3 <- summary(lm(plantC ~ year, ea3sa1DBHgl_out_annual_tile[1:150,]))$coefficients[2,1]
sd3 <- summary(lm(plantC ~ year, ea3sa1DBHgl_out_annual_tile[1:150,]))$coefficients[2,2]

mean1 <- ea1sa1DBHgl_out_annual_tile[1300:1804,] %>% summarise(mean1=mean(plantC,na.rm=T), sd1=sd(plantC,na.rm=T))
mean2 <- ea2sa1DBHgl_out_annual_tile[1300:1804,] %>% summarise(mean2=mean(plantC,na.rm=T), sd2=sd(plantC,na.rm=T))
mean3 <- ea3sa1DBHgl_out_annual_tile[1300:1804,] %>% summarise(mean3=mean(plantC,na.rm=T), sd3=sd(plantC,na.rm=T))

slopes <- c(slope1,slope2,slope3)
sdSlopes <- c(sd1,sd2,sd3)
meanBstar <- c(mean1$mean1,mean2$mean2, mean3$mean3)
sdBstar <- c(mean1$sd1,mean2$sd2, mean3$sd3)
level <- as.factor(c("Control","+15%","+30%"))
mortality <- as.factor(c("DBH","DBH","DBH"))
dataSlopeA <- data.frame(mortality,level,slopes,sdSlopes,meanBstar,sdBstar)

ggplot(data=dataSlopeA) +
  geom_point(aes(x=slopes, y=meanBstar,color=level)) +
  geom_errorbar(aes(x = slopes, ymin=meanBstar-sdBstar, ymax=meanBstar+sdBstar, color=level),width=0) + 
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Slope of B ~ t", y = expression(paste("Mean biomass at maturity (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  ggtitle("Mortality formulation DBH")

# Mortality Ratio NSC and Leaf Mass
slope1 <- summary(lm(plantC ~ year, ea1sa1mb_out_annual_tile[1:150,]))$coefficients[2,1]
sd1 <- summary(lm(plantC ~ year, ea1sa1mb_out_annual_tile[1:150,]))$coefficients[2,2]
slope2 <- summary(lm(plantC ~ year, ea2sa1mb_out_annual_tile[1:150,]))$coefficients[2,1]
sd2 <- summary(lm(plantC ~ year, ea2sa1mb_out_annual_tile[1:150,]))$coefficients[2,2]
slope3 <- summary(lm(plantC ~ year, ea3sa1mb_out_annual_tile[1:150,]))$coefficients[2,1]
sd3 <- summary(lm(plantC ~ year, ea3sa1mb_out_annual_tile[1:150,]))$coefficients[2,2]

mean1 <- ea1sa1mb_out_annual_tile[1300:1804,] %>% summarise(mean1=mean(plantC,na.rm=T), sd1=sd(plantC,na.rm=T))
mean2 <- ea2sa1mb_out_annual_tile[1300:1804,] %>% summarise(mean2=mean(plantC,na.rm=T), sd2=sd(plantC,na.rm=T))
mean3 <- ea3sa1mb_out_annual_tile[1300:1804,] %>% summarise(mean3=mean(plantC,na.rm=T), sd3=sd(plantC,na.rm=T))

slopes <- c(slope1,slope2,slope3)
sdSlopes <- c(sd1,sd2,sd3)
meanBstar <- c(mean1$mean1,mean2$mean2, mean3$mean3)
sdBstar <- c(mean1$sd1,mean2$sd2, mean3$sd3)
level <- as.factor(c("Control","+15%","+30%"))
mortality <- as.factor(c("NSC/Leaf mass","NSC/Leaf mass","NSC/Leaf mass"))
dataSlopeB <- data.frame(mortality,level,slopes,sdSlopes,meanBstar,sdBstar)

ggplot(data=dataSlopeB) +
  geom_point(aes(x=slopes, y=meanBstar,color=level)) +
  geom_errorbar(aes(x = slopes, ymin=meanBstar-sdBstar, ymax=meanBstar+sdBstar, color=level),width=0) + 
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Slope of B ~ t", y = expression(paste("Mean biomass at maturity (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  ggtitle("Mortality formulation Ratio NSC - Leaf mass")

# Mortality Growth rate
slope1 <- summary(lm(plantC ~ year, ea1sa1mc_out_annual_tile[1:150,]))$coefficients[2,1]
sd1 <- summary(lm(plantC ~ year, ea1sa1mc_out_annual_tile[1:150,]))$coefficients[2,2]
slope2 <- summary(lm(plantC ~ year, ea2sa1mc_out_annual_tile[1:150,]))$coefficients[2,1]
sd2 <- summary(lm(plantC ~ year, ea2sa1mc_out_annual_tile[1:150,]))$coefficients[2,2]
slope3 <- summary(lm(plantC ~ year, ea3sa1mc_out_annual_tile[1:150,]))$coefficients[2,1]
sd3 <- summary(lm(plantC ~ year, ea3sa1mc_out_annual_tile[1:150,]))$coefficients[2,2]

mean1 <- ea1sa1mc_out_annual_tile[1300:1804,] %>% summarise(mean1=mean(plantC,na.rm=T), sd1=sd(plantC,na.rm=T))
mean2 <- ea2sa1mc_out_annual_tile[1300:1804,] %>% summarise(mean2=mean(plantC,na.rm=T), sd2=sd(plantC,na.rm=T))
mean3 <- ea3sa1mc_out_annual_tile[1300:1804,] %>% summarise(mean3=mean(plantC,na.rm=T), sd3=sd(plantC,na.rm=T))

slopes <- c(slope1,slope2,slope3)
sdSlopes <- c(sd1,sd2,sd3)
meanBstar <- c(mean1$mean1,mean2$mean2, mean3$mean3)
sdBstar <- c(mean1$sd1,mean2$sd2, mean3$sd3)
level <- as.factor(c("Control","+15%","+30%"))
mortality <- as.factor(c("Growth ratio","Growth ratio","Growth ratio"))
dataSlopeC <- data.frame(mortality,level,slopes,sdSlopes,meanBstar,sdBstar)

ggplot(data=dataSlopeC) +
  geom_point(aes(x=slopes, y=meanBstar,color=level)) +
  geom_errorbar(aes(x = slopes, ymin=meanBstar-sdBstar, ymax=meanBstar+sdBstar, color=level),width=0) + 
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Slope of B ~ t", y = expression(paste("Mean biomass at maturity (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  ggtitle("Mortality formulation Growth rate")

# Mortality Constrant self-thinning
slope1 <- summary(lm(plantC ~ year, ea1sa1md_out_annual_tile[1:150,]))$coefficients[2,1]
sd1 <- summary(lm(plantC ~ year, ea1sa1md_out_annual_tile[1:150,]))$coefficients[2,2]
slope2 <- summary(lm(plantC ~ year, ea2sa1md_out_annual_tile[1:150,]))$coefficients[2,1]
sd2 <- summary(lm(plantC ~ year, ea2sa1md_out_annual_tile[1:150,]))$coefficients[2,2]
slope3 <- summary(lm(plantC ~ year, ea3sa1md_out_annual_tile[1:150,]))$coefficients[2,1]
sd3 <- summary(lm(plantC ~ year, ea3sa1md_out_annual_tile[1:150,]))$coefficients[2,2]

mean1 <- ea1sa1md_out_annual_tile[1300:1804,] %>% summarise(mean1=mean(plantC,na.rm=T), sd1=sd(plantC,na.rm=T))
mean2 <- ea2sa1md_out_annual_tile[1300:1804,] %>% summarise(mean2=mean(plantC,na.rm=T), sd2=sd(plantC,na.rm=T))
mean3 <- ea3sa1md_out_annual_tile[1300:1804,] %>% summarise(mean3=mean(plantC,na.rm=T), sd3=sd(plantC,na.rm=T))

slopes <- c(slope1,slope2,slope3)
sdSlopes <- c(sd1,sd2,sd3)
meanBstar <- c(mean1$mean1,mean2$mean2, mean3$mean3)
sdBstar <- c(mean1$sd1,mean2$sd2, mean3$sd3)
level <- as.factor(c("Control","+15%","+30%"))
mortality <- as.factor(c("Constant self-thinning","Constant self-thinning","Constant self-thinning"))
dataSlopeD <- data.frame(mortality,level,slopes,sdSlopes,meanBstar,sdBstar)

ggplot(data=dataSlopeD) +
  geom_point(aes(x=slopes, y=meanBstar,color=level)) +
  geom_errorbar(aes(x = slopes, ymin=meanBstar-sdBstar, ymax=meanBstar+sdBstar, color=level),width=0) + 
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Slope of B ~ t", y = expression(paste("Mean biomass at maturity (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  ggtitle("Mortality formulation Growth rate")

# facet_wrap
dataSlope <- rbind(dataSlopeA, dataSlopeB, dataSlopeC,dataSlopeD)

ggplot(data=dataSlope) +
  geom_point(aes(x=slopes, y=meanBstar,color=level)) + facet_wrap(~ mortality, ncol=4)+
  geom_errorbar(aes(x = slopes, ymin=meanBstar-sdBstar, ymax=meanBstar+sdBstar, color=level),width=0) + 
  scale_color_manual(labels = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(col = "Levels of LUE",x = "Slope of B ~ t", y = expression(paste("Mean biomass at maturity (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

```

### Aboveground NPP vs. Biomass

From annual_tile_output: PlanC (Biomass)

```{r}

# Biomass changes in LUE with WD level 1
# Mortality DBH

ggplot() + 
  geom_line(data=ea1sa1magl_out_annual_tile, aes(x=plantC, y=NPP, color='Control')) + 
  geom_line(data=ea2sa1magl_out_annual_tile, aes(x=plantC, y=NPP, color='+15%')) +
  geom_line(data=ea3sa1magl_out_annual_tile, aes(x=plantC, y=NPP, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x="Biomass", y="NPP")+
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Mortality formulation DBH")

## A_Biomass and A_NPP need to be calculated in the model!
ggplot() + 
  geom_line(data=ea1sa1magl_out_annual_tile, aes(x=A_Biomass, y=A_NPP, color='Control')) + 
  geom_line(data=ea2sa1magl_out_annual_tile, aes(x=A_Biomass, y=A_NPP, color='+15%')) +
  geom_line(data=ea3sa1magl_out_annual_tile, aes(x=A_Biomass, y=A_NPP, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x="(A)Biomass", y="(A)NPP")+
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Mortality formulation DBH")

# Biomass changes in LUE with WD level 1
# Mortality Ratio NSC and Leaf Mass
ggplot() + 
  geom_line(data=ea1sa1mb_out_annual_tile, aes(x=A_Biomass, y=A_NPP, color='Control')) + 
  geom_line(data=ea2sa1mb_out_annual_tile, aes(x=A_Biomass, y=A_NPP, color='+15%')) +
  geom_line(data=ea3sa1mb_out_annual_tile, aes(x=A_Biomass, y=A_NPP, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x="(A)Biomass", y="(A)NPP")+
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Mortality formulation Ratio NSC - Leaf mass")

# Biomass changes in LUE with WD level 1
# Mortality Growth rate
ggplot() + 
  geom_line(data=ea1sa1mc_out_annual_tile, aes(x=A_Biomass, y=A_NPP, color='Control')) + 
  geom_line(data=ea2sa1mc_out_annual_tile, aes(x=A_Biomass, y=A_NPP, color='+15%')) +
  geom_line(data=ea3sa1mc_out_annual_tile, aes(x=A_Biomass, y=A_NPP, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x="(A)Biomass", y="(A)NPP")+
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Mortality formulation Growth rate")

# Biomass changes in LUE with WD level 1
# Mortality Constant Self-thinning
ggplot() + 
  geom_line(data=ea1sa1md_out_annual_tile, aes(x=A_Biomass, y=A_NPP, color='Control')) + 
  geom_line(data=ea2sa1md_out_annual_tile, aes(x=A_Biomass, y=A_NPP, color='+15%')) +
  geom_line(data=ea3sa1md_out_annual_tile, aes(x=A_Biomass, y=A_NPP, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x="(A)Biomass", y="(A)NPP")+
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Mortality formulation Constant Self-thinning")

```

### NPP vs. mortality

From annual_tile_output: PlanC (Biomass)

```{r}

# Biomass changes in LUE with WD level 1
# Mortality DBH

ggplot() + 
  geom_line(data=ea1sa1DBHgl_out_annual_tile, aes(x=c_deadtrees, y=NPP, color='Control')) + 
  geom_line(data=ea2sa1DBHgl_out_annual_tile, aes(x=c_deadtrees, y=NPP, color='+15%')) +
  geom_line(data=ea3sa1DBHgl_out_annual_tile, aes(x=c_deadtrees, y=NPP, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x="Turnover", y="NPP")+
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Mortality formulation DBH")

ggplot() + 
  geom_line(data=ea1sa1DBHgl_out_annual_tile, aes(x=n_deadtrees, y=NPP, color='Control')) + 
  geom_line(data=ea2sa1DBHgl_out_annual_tile, aes(x=n_deadtrees, y=NPP, color='+15%')) +
  geom_line(data=ea3sa1DBHgl_out_annual_tile, aes(x=n_deadtrees, y=NPP, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x="Turnover", y="NPP")+
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Mortality formulation DBH")

ggplot() + 
  geom_line(data=ea1sa1magl_out_annual_tile, aes(x=c_deadtrees, y=A_NPP, color='Control')) + 
  geom_line(data=ea2sa1magl_out_annual_tile, aes(x=c_deadtrees, y=A_NPP, color='+15%')) +
  geom_line(data=ea3sa1magl_out_annual_tile, aes(x=c_deadtrees, y=A_NPP, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x="Turnover", y="(A)NPP")+
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Mortality formulation DBH")

# Biomass changes in LUE with WD level 1
# Mortality Ratio NSC and Leaf Mass
ggplot() + 
  geom_line(data=ea1sa1mb_out_annual_tile, aes(x=c_deadtrees, y=A_NPP, color='Control')) + 
  geom_line(data=ea2sa1mb_out_annual_tile, aes(x=c_deadtrees, y=A_NPP, color='+15%')) +
  geom_line(data=ea3sa1mb_out_annual_tile, aes(x=c_deadtrees, y=A_NPP, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x="Turnover", y="(A)NPP")+
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Mortality formulation Ratio NSC - Leaf mass")

# Biomass changes in LUE with WD level 1
# Mortality Growth rate
ggplot() + 
  geom_line(data=ea1sa1mc_out_annual_tile, aes(x=c_deadtrees, y=A_NPP, color='Control')) + 
  geom_line(data=ea2sa1mc_out_annual_tile, aes(x=c_deadtrees, y=A_NPP, color='+15%')) +
  geom_line(data=ea3sa1mc_out_annual_tile, aes(x=c_deadtrees, y=A_NPP, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x="Turnover", y="(A)NPP")+
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Mortality formulation Growth rate")

# Biomass changes in LUE with WD level 1
# Mortality Constant Self-thinning
ggplot() + 
  geom_line(data=ea1sa1md_out_annual_tile, aes(x=c_deadtrees, y=A_NPP, color='Control')) + 
  geom_line(data=ea2sa1md_out_annual_tile, aes(x=c_deadtrees, y=A_NPP, color='+15%')) +
  geom_line(data=ea3sa1md_out_annual_tile, aes(x=c_deadtrees, y=A_NPP, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x="Turnover", y="(A)NPP")+
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Mortality formulation Constant Self-thinning")

```

### B* at maturity

From new annual_tile_output

```{r}

# Changes in LUE with WD level 1
ggplot() + 
  geom_point(data=ea1sa1DBHgl_out_annual_tile[50:1804,], aes(x=log(QMD), y=log(Density12), color='Control')) + 
  geom_point(data=ea2sa1DBHgl_out_annual_tile[50:1804,], aes(x=log(QMD), y=log(Density12), color='+15%')) +
  geom_point(data=ea3sa1DBHgl_out_annual_tile[50:1804,], aes(x=log(QMD), y=log(Density12), color='+30%')) +
  scale_color_manual("Levels of LUE at WD 1", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  scale_y_continuous(limits = c(3.5,8)) +
  labs(x = "Ln(QMD)", y = "Ln(N)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = ea1sa1DBHgl_out_annual_tile[50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = ea1sa1DBHgl_out_annual_tile[50:1804,]))[2], color="#F8766D") +
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = ea2sa1DBHgl_out_annual_tile[50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = ea2sa1DBHgl_out_annual_tile[50:1804,]))[2], color="#00BA38") +
  geom_abline(intercept = coef(lm(log(Density12) ~ log(QMD), data = ea3sa1DBHgl_out_annual_tile[50:1804,]))[1], 
              slope = coef(lm(log(Density12) ~ log(QMD), data = ea3sa1DBHgl_out_annual_tile[50:1804,]))[2], color="#619CFF")

lm1 <- lm(log(Density12) ~ log(QMD), data = ea1sa1DBHgl_out_annual_tile[50:1804,])
summary(lm1)
new1 <- data.frame(QMD = seq(0.1, 1, 0.1))
predictedDensity1 <- predict(lm1, new1)
new1 <- data.frame(QMD = seq(0.1, 1, 0.1),predictedDensity1)

lm2 <- lm(log(Density12) ~ log(QMD), data = ea2sa1DBHgl_out_annual_tile[50:1804,])
summary(lm2)
new2 <- data.frame(QMD = seq(0.1, 1, 0.1))
predictedDensity2 <- predict(lm2, new2)
new2 <- data.frame(QMD = seq(0.1, 1, 0.1),predictedDensity2)

lm3 <- lm(log(Density12) ~ log(QMD), data = ea3sa1DBHgl_out_annual_tile[50:1804,])
summary(lm3)
new3 <- data.frame(QMD = seq(0.1, 1, 0.1))
predictedDensity3 <- predict(lm3, new3)
new3 <- data.frame(QMD = seq(0.1, 1, 0.1),predictedDensity3)

BiomassMaturityLUE1WD1 <- ea1sa1DBHgl_out_annual_tile[1300:1804,] %>% summarise(B_star = mean(plantC,na.rm=T)) %>% mutate(N_QMD = new1[5,2])
BiomassMaturityLUE2WD1 <- ea2sa1DBHgl_out_annual_tile[1300:1804,] %>% summarise(B_star = mean(plantC,na.rm=T)) %>% mutate(N_QMD = new2[5,2])
BiomassMaturityLUE3WD1 <- ea3sa1DBHgl_out_annual_tile[1300:1804,] %>% summarise(B_star = mean(plantC,na.rm=T)) %>% mutate(N_QMD = new3[5,2])

ggplot() + 
  geom_point(data=BiomassMaturityLUE1WD1, aes(x=N_QMD, y=B_star, color='Control')) + 
  geom_point(data=BiomassMaturityLUE2WD1, aes(x=N_QMD, y=B_star, color='+15%')) +
  geom_point(data=BiomassMaturityLUE3WD1, aes(x=N_QMD, y=B_star, color='+30%')) +
  scale_color_manual("Levels of LUE at WD 1", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "N at QMD=0.5", y = "B*") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

```

### Longevity vs. growth rates

Hypothesis: The negative relationship between longevity vs. growth rates arises from variations between (across) species, but disappears when looking at variations between sites (within sps).

Two plots:

- Different species at a given site: x = growth rate, y = longevity (or 1/mortality). Each point is one species (differing by wood density, root:shoot ratio). Add info either by using color ~site (given LUE, growing season length, PAR); or by combining data from multiple sites and normalizing growth rates and longevity by site-level mean.
- Same species at different sites (differing by LUE, growing season length, PAR): x = growth rate, y = longevity. Each point is one site (show mean and standard deviations with x and y errorbars)

Todo:

- longevity is maximum age at tile-level, plot mean across multiple years after spinup
- plot change in DBH instead of NPP. Take the oldest cohort, and calculate DBH/age


```{r, fig.width = 10, fig.height = 4}
ea1sa1DBHgl_out_annual_tileMaxAgg <- ea1sa1DBHgl_out_annual_tile[1500:1801,] %>% summarise(maxAge_mean=mean(MaxAge,na.rm=T), maxAge_sd=sd(MaxAge,na.rm=T),DBH_mean=mean(DBH,na.rm=T), DBH_sd=sd(DBH,na.rm=T),MaxDBH_MaxAge_mean=mean(MaxDBH_MaxAge,na.rm=T), MaxDBH_MaxAge_sd=sd(MaxDBH_MaxAge,na.rm=T))

ea2sa1DBHgl_out_annual_tileMaxAgg <- ea2sa1DBHgl_out_annual_tile[1500:1801,] %>% summarise(maxAge_mean=mean(MaxAge,na.rm=T), maxAge_sd=sd(MaxAge,na.rm=T),DBH_mean=mean(DBH,na.rm=T), DBH_sd=sd(DBH,na.rm=T),MaxDBH_MaxAge_mean=mean(MaxDBH_MaxAge,na.rm=T), MaxDBH_MaxAge_sd=sd(MaxDBH_MaxAge,na.rm=T))

ea3sa1DBHgl_out_annual_tileMaxAgg <- ea3sa1DBHgl_out_annual_tile[1500:1801,] %>% summarise(maxAge_mean=mean(MaxAge,na.rm=T), maxAge_sd=sd(MaxAge,na.rm=T),DBH_mean=mean(DBH,na.rm=T), DBH_sd=sd(DBH,na.rm=T),MaxDBH_MaxAge_mean=mean(MaxDBH_MaxAge,na.rm=T), MaxDBH_MaxAge_sd=sd(MaxDBH_MaxAge,na.rm=T))


ggplot() + 
  geom_point(data=ea1sa1DBHgl_out_annual_tileMaxAgg, aes(x=MaxDBH_MaxAge_mean, y=maxAge_mean, color='Control')) + 
  geom_errorbar(data=ea1sa1DBHgl_out_annual_tileMaxAgg, aes(x=MaxDBH_MaxAge_mean, ymin=maxAge_mean-maxAge_sd,
                                                           ymax=maxAge_mean+maxAge_sd,color='Control'),width=0) +
  geom_errorbar(data=ea1sa1DBHgl_out_annual_tileMaxAgg, aes(xmin=MaxDBH_MaxAge_mean-MaxDBH_MaxAge_sd,
                                                           xmax=MaxDBH_MaxAge_mean+MaxDBH_MaxAge_sd,
                                                           y= maxAge_mean,color='Control'),width=0)+
  geom_point(data=ea2sa1DBHgl_out_annual_tileMaxAgg, aes(x=MaxDBH_MaxAge_mean, y=maxAge_mean, color='+15%')) + 
  geom_errorbar(data=ea2sa1DBHgl_out_annual_tileMaxAgg, aes(x=MaxDBH_MaxAge_mean, ymin=maxAge_mean-maxAge_sd,
                                                           ymax=  maxAge_mean+maxAge_sd,color='+15%'),width=0) +
  geom_errorbar(data=ea2sa1DBHgl_out_annual_tileMaxAgg, aes(xmin=MaxDBH_MaxAge_mean-MaxDBH_MaxAge_sd,
                                                           xmax=MaxDBH_MaxAge_mean+MaxDBH_MaxAge_sd,
                                                           y= maxAge_mean,color='+15%'),width=0)+
  geom_point(data=ea3sa1DBHgl_out_annual_tileMaxAgg, aes(x=MaxDBH_MaxAge_mean, y=maxAge_mean, color='+30%')) + 
  geom_errorbar(data=ea3sa1DBHgl_out_annual_tileMaxAgg, aes(x=MaxDBH_MaxAge_mean, ymin=maxAge_mean-maxAge_sd,
                                                           ymax=  maxAge_mean+maxAge_sd,color='+30%'),width=0) +
  geom_errorbar(data=ea3sa1DBHgl_out_annual_tileMaxAgg, aes(xmin=MaxDBH_MaxAge_mean-MaxDBH_MaxAge_sd,
                                                           xmax=MaxDBH_MaxAge_mean+MaxDBH_MaxAge_sd,
                                                           y= maxAge_mean,color='+30%'),width=0)+
  scale_color_manual("Levels of LUE at WD 1", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = expression(paste("Growth rate (DBH ",age^-1,  ") ")), y = "Longevity") +  
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") 


# Facet wrap
data1 <- rbind(ea1sa1ma_out_annual_tile, ea2sa1ma_out_annual_tile, ea3sa1ma_out_annual_tile,
               ea1sa1mb_out_annual_tile, ea2sa1mb_out_annual_tile, ea3sa1mb_out_annual_tile,
               ea1sa1mc_out_annual_tile, ea2sa1mc_out_annual_tile, ea3sa1mc_out_annual_tile,
               ea1sa1md_out_annual_tile, ea2sa1md_out_annual_tile, ea3sa1md_out_annual_tile)

data1$Mortality <- factor(data1$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate","Constant Self-thinning"))

data1MAxAgg <- data1 %>% filter(year>=1300) %>% group_by(Mortality,LevelLUE) %>% summarise(maxAge_mean=mean(MaxAge,na.rm=T), sdmaxAge=sd(MaxAge,na.rm=T),
                                  MaxVolume_MaxAge_mean=mean(MaxVolume_MaxAge,na.rm=T), sdMaxVolume_MaxAge=sd(MaxVolume_MaxAge,na.rm=T),
                                  MaxDBH_MaxAge_mean=mean(MaxDBH_MaxAge,na.rm=T), sdMaxDBH_MaxAge=sd(MaxDBH_MaxAge,na.rm=T))
 
ggplot() + 
  geom_point(data=data1MAxAgg, aes(x=MaxVolume_MaxAge_mean, y=maxAge_mean, color=as.factor(LevelLUE))) +
  geom_errorbar(data=data1MAxAgg, aes(x=MaxVolume_MaxAge_mean, ymin=maxAge_mean-sdmaxAge,ymax=maxAge_mean+sdmaxAge,color=as.factor(LevelLUE)),width=0) +
  geom_errorbar(data=data1MAxAgg, aes(xmin=MaxVolume_MaxAge_mean-sdMaxVolume_MaxAge,xmax= MaxVolume_MaxAge_mean+sdMaxVolume_MaxAge , y=maxAge_mean,color=as.factor(LevelLUE)),width=0) +
  scale_color_manual(labels = c("Control","+15%", "+30%"),values = c("#F8766D", "#00BA38", "#619CFF"))+
  labs(col="Levels of LUE",x = expression(paste("Growth rate (Volume ",age^-1,  ") ")), y = "Longevity") +  
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  facet_wrap(~ Mortality, ncol=4)

ggplot() + 
  geom_point(data=data1MAxAgg, aes(x=MaxDBH_MaxAge_mean, y=maxAge_mean, color=as.factor(LevelLUE))) +
  geom_errorbar(data=data1MAxAgg, aes(x=MaxDBH_MaxAge_mean, ymin=maxAge_mean-sdmaxAge,ymax=maxAge_mean+sdmaxAge,color=as.factor(LevelLUE)),width=0) +
  geom_errorbar(data=data1MAxAgg, aes(xmin=MaxDBH_MaxAge_mean-sdMaxDBH_MaxAge,xmax= MaxDBH_MaxAge_mean+sdMaxDBH_MaxAge , y=maxAge_mean,color=as.factor(LevelLUE)),width=0) +
  scale_color_manual(labels = c("Control","+15%", "+30%"),values = c("#F8766D", "#00BA38", "#619CFF"))+
  labs(col="Levels of LUE",x = expression(paste("Growth rate (DBH ",age^-1,  ") ")), y = "Longevity") +  
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  facet_wrap(~ Mortality, ncol=4)
```

## CO2 levels

### Stand develop: Stand biomass vs. time

From annual_tile_output: PlanC (Biomass)
Level of CO2

```{r}
# Mortality as a function of DBH
# Biomass changes in LUE with WD level 1
BioCO2 <- ggplot() + 
  geom_line(data=ec1sa1DBHgl_out_annual_tile, aes(x=year, y=plantC, color='Control')) + 
  geom_line(data=ec2sa1DBHgl_out_annual_tile, aes(x=year, y=plantC, color='+15%')) +
  geom_line(data=ec3sa1DBHgl_out_annual_tile, aes(x=year, y=plantC, color='+30%')) +
  scale_color_manual("Levels of CO2", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#619CFF", "#00BA38"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom",
        axis.text = element_text(size = 10),axis.title = element_text(size = 11),
        legend.text = element_text(size = 10),legend.title = element_text(size = 11),
        plot.title = element_text(size = 11)) + 
  labs(title= "Tree mortality as a function of size")

# Mortality as a function of C starvation
# Biomass changes in LUE with WD level 1
BioNSC <- ggplot() + 
  geom_line(data=ec1sa1NSCgl_out_annual_tile, aes(x=year, y=plantC, color='Control')) + 
  geom_line(data=ec2sa1NSCgl_out_annual_tile, aes(x=year, y=plantC, color='+15%')) +
  geom_line(data=ec3sa1NSCgl_out_annual_tile, aes(x=year, y=plantC, color='+30%')) +
  scale_color_manual("Levels of CO2", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#619CFF", "#00BA38"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom",
        axis.text = element_text(size = 10),axis.title = element_text(size = 11),
        legend.text = element_text(size = 10),legend.title = element_text(size = 11),
        plot.title = element_text(size = 11)) + 
  labs(title= "Tree mortality as a function of C starvation")

# Mortality as a function of Growth rate
# Biomass changes in LUE with WD level 1
BioGR <- ggplot() + 
  geom_line(data=ea1sa1GRgl_out_annual_tile, aes(x=year, y=plantC, color='Control')) + 
  geom_line(data=ea2sa1GRgl_out_annual_tile, aes(x=year, y=plantC, color='+15%')) +
  geom_line(data=ea3sa1GRgl_out_annual_tile, aes(x=year, y=plantC, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#619CFF", "#00BA38"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom",
        axis.text = element_text(size = 10),axis.title = element_text(size = 11),
        legend.text = element_text(size = 10),legend.title = element_text(size = 11),
        plot.title = element_text(size = 11)) + 
  labs(title= "Tree mortality as a function of growth rate") 

# Mortality as a function of Self-thinning
# Biomass changes in LUE with WD level 1
ggplot() + 
  geom_line(data=ea1sa1CSTgl_out_annual_tile, aes(x=year, y=plantC, color='Control')) + 
  geom_line(data=ea2sa1CSTgl_out_annual_tile, aes(x=year, y=plantC, color='+15%')) +
  geom_line(data=ea3sa1CSTgl_out_annual_tile, aes(x=year, y=plantC, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#619CFF", "#00BA38"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Function of Constant Self-thinning gs-Leuning") 

```
#### Arrange plots

```{r, include=F, eval=T,fig.height=4,fig.width=10}
library(ggpubr) # ggarrange
ggarrange(BioDBH,BioNSC,BioGR, ncol = 3, nrow = 1, common.legend = T,legend="right")
ggsave("plotBio.tiff", width = 10, height = 3, device='tiff', dpi=300)

```

### Arrange figures
```{r, fig.width = 10, fig.height = 4}

## All mortality form with facet_wrap
data1 <- rbind(ea1sa1DBHgl_out_annual_tile, ea2sa1DBHgl_out_annual_tile, ea3sa1DBHgl_out_annual_tile,
               ea1sa1NSCgl_out_annual_tile, ea2sa1NSCgl_out_annual_tile, ea3sa1NSCgl_out_annual_tile,
               ea1sa1GRgl_out_annual_tile,  ea2sa1GRgl_out_annual_tile,  ea3sa1GRgl_out_annual_tile)

data1$Mortality <- factor(data1$Mortality, levels = c("DBH", "NSC", "GR"),
                  labels = c("Tree mortality as function of size", "Tree mortality as function of C starvation", "Tree mortality as function of growth rate"))

ggplot(data=data1) +
  geom_line(aes(x=year, y=plantC,color=as.factor(LevelLUE))) + facet_wrap(~ Mortality, ncol=3)+
  scale_color_manual(labels = c("Low", "Medium", "High"), values = c("#F8766D" ,"#619CFF", "#00BA38"))+
  labs(col = "Growth rate",x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "right",legend.text = element_text(size=10),legend.title = element_text(size=10))

ggsave("plotBio.tiff", width = 9.5, height = 3, device='tiff', dpi=300)


```

### Carbon Turnover time vs. time

From annual_tile_output: c_turnover_time 
Level of CO2

```{r}
# Mortality as a function of DBH
# Biomass changes in LUE with WD level 1
TauCO2 <- ggplot() + 
  geom_line(data=ec1sa1DBHgl_out_annual_tile, aes(x=year, y=c_turnover_time, color='Control')) + 
  geom_line(data=ec2sa1DBHgl_out_annual_tile, aes(x=year, y=c_turnover_time, color='+15%')) +
  geom_line(data=ec3sa1DBHgl_out_annual_tile, aes(x=year, y=c_turnover_time, color='+30%')) +
  scale_color_manual("Levels of CO2", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#619CFF", "#00BA38"))+
  labs(x = "Year", y = expression(paste("Carbon turnover time ( ", tau, " , ", yr, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom",
        axis.text = element_text(size = 10),axis.title = element_text(size = 11),
        legend.text = element_text(size = 10),legend.title = element_text(size = 11),
        plot.title = element_text(size = 11)) + 
  labs(title= "Tree mortality as a function of size")

# Mortality as a function of C starvation
# Biomass changes in LUE with WD level 1
TauNSC <- ggplot() + 
  geom_line(data=ec1sa1NSCgl_out_annual_tile, aes(x=year, y=c_turnover_time, color='Control')) + 
  geom_line(data=ec2sa1NSCgl_out_annual_tile, aes(x=year, y=c_turnover_time, color='+15%')) +
  geom_line(data=ec3sa1NSCgl_out_annual_tile, aes(x=year, y=c_turnover_time, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#619CFF", "#00BA38"))+
  labs(x = "Year", y = expression(paste("Carbon turnover time ( ", tau, " , ", yr, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom",
        axis.text = element_text(size = 10),axis.title = element_text(size = 11),
        legend.text = element_text(size = 10),legend.title = element_text(size = 11),
        plot.title = element_text(size = 11)) + 
  labs(title= "Tree mortality as a function of C starvation")

# Mortality as a function of Growth rate
# Biomass changes in LUE with WD level 1
BioGR <- ggplot() + 
  geom_line(data=ea1sa1GRgl_out_annual_tile, aes(x=year, y=c_turnover_time, color='Control')) + 
  geom_line(data=ea2sa1GRgl_out_annual_tile, aes(x=year, y=c_turnover_time, color='+15%')) +
  geom_line(data=ea3sa1GRgl_out_annual_tile, aes(x=year, y=c_turnover_time, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#619CFF", "#00BA38"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " , ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom",
        axis.text = element_text(size = 10),axis.title = element_text(size = 11),
        legend.text = element_text(size = 10),legend.title = element_text(size = 11),
        plot.title = element_text(size = 11)) + 
  labs(title= "Tree mortality as a function of growth rate") 

# Mortality as a function of Self-thinning
# Biomass changes in LUE with WD level 1
ggplot() + 
  geom_line(data=ea1sa1CSTgl_out_annual_tile, aes(x=year, y=c_turnover_time, color='Control')) + 
  geom_line(data=ea2sa1CSTgl_out_annual_tile, aes(x=year, y=c_turnover_time, color='+15%')) +
  geom_line(data=ea3sa1CSTgl_out_annual_tile, aes(x=year, y=c_turnover_time, color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#619CFF", "#00BA38"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Function of Constant Self-thinning gs-Leuning") 

```

### Deathrate

From output_annual_cohorts: deathrate 

```{r}
# Mortality as a function of DBH
# Biomass changes in LUE with WD level 1
mortDBH1 <- ggplot() + 
  geom_line(data=subset(ec1sa1DBHgl_out_annual_cohorts,dbh>0.1), aes(x=dbh, y=deathrate, color='Control')) + 
  geom_line(data=subset(ec2sa1DBHgl_out_annual_cohorts,dbh>0.1), aes(x=dbh, y=deathrate, color='+15%')) +
  geom_line(data=subset(ec3sa1DBHgl_out_annual_cohorts,dbh>0.1), aes(x=dbh, y=deathrate, color='+30%')) +
  scale_color_manual("Levels of CO2", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#619CFF", "#00BA38"))+
  labs(x = "dbh", y = expression(paste("Canopy mortality (", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom",
        axis.text = element_text(size = 10),axis.title = element_text(size = 11),
        legend.text = element_text(size = 10),legend.title = element_text(size = 11),
        plot.title = element_text(size = 11)) + 
  labs(title= "Tree mortality as a function of size")

mortDBH2 <- ggplot() + 
  geom_line(data=subset(ec1sa1DBHgl_out_annual_cohorts,dbh<0.05), aes(x=dbh, y=deathrate, color='Control')) + 
  geom_line(data=subset(ec2sa1DBHgl_out_annual_cohorts,dbh<0.05), aes(x=dbh, y=deathrate, color='+15%')) +
  geom_line(data=subset(ec3sa1DBHgl_out_annual_cohorts,dbh<0.05), aes(x=dbh, y=deathrate, color='+30%')) +
  scale_color_manual("Levels of CO2", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#619CFF", "#00BA38"))+
  labs(x = "dbh", y = expression(paste("Understory mortality (", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom",
        axis.text = element_text(size = 10),axis.title = element_text(size = 11),
        legend.text = element_text(size = 10),legend.title = element_text(size = 11),
        plot.title = element_text(size = 11)) + 
  labs(title= "Tree mortality as a function of size")

library(ggpubr) # ggarrange

ggarrange(mortDBH2,mortDBH1,ncol = 2, nrow = 1, common.legend = T,legend="bottom")

# Mortality as a function of DBH
# Biomass changes in LUE with WD level 1
mortNSC <- ggplot() + 
  geom_line(data=ec1sa1NSCgl_out_annual_cohorts, aes(x=dbh, y=deathrate, color='Control')) + 
  geom_line(data=ec2sa1NSCgl_out_annual_cohorts, aes(x=dbh, y=deathrate, color='+15%')) +
  geom_line(data=ec3sa1NSCgl_out_annual_cohorts, aes(x=dbh, y=deathrate, color='+30%')) +
  scale_color_manual("Levels of CO2", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#619CFF", "#00BA38"))+
  labs(x = "Year", y = expression(paste("Mortality (", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom",
        axis.text = element_text(size = 10),axis.title = element_text(size = 11),
        legend.text = element_text(size = 10),legend.title = element_text(size = 11),
        plot.title = element_text(size = 11)) + 
  labs(title= "Tree mortality as a function of C starvation")

```

### Self-thinning relationship

From annual_tile_output: QMD and Density12
LUE (mol/s/m2)

```{r, include=T, eval=T,fig.height=6,fig.width=8}

# Mortality as a function of DBH

data1 <- rbind(ec1sa1DBHgl_out_annual_tile, ec2sa1DBHgl_out_annual_tile, ec3sa1DBHgl_out_annual_tile)
ggplot() + 
  geom_point(data=subset(data1, year>=500), aes(x=log(QMD), y=log(Density12), color=as.factor(LevelCO2)),alpha=1) + 
  geom_smooth(data=subset(data1, year>=500), aes(x=log(QMD), y=log(Density12), color=as.factor(LevelCO2)),method = "lm",fullrange = T) +
  scale_color_manual(labels = c("Low","Medium", "High"),values = c("#F8766D" ,"#619CFF","#00BA38"))+
  labs(col = "Growth rate", x = "Quadratic Mean Diameter (QMD)", y = "Stand density (N)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") + 
  ggtitle("") + 
  scale_x_continuous(limits = c(3.5,4),breaks = seq(3.5,4,0.1)) + 
  scale_y_continuous(limits = c(4.75,6.25),breaks = seq(4.75,6.25,0.25))

ggsave("figure1.2.tiff", width = 5, height = 5, device='tiff', dpi=300)

# Mortality as a function of NSC

data1 <- rbind(ea1sa1NSCgl_out_annual_tile, ea2sa1NSCgl_out_annual_tile, ea3sa1NSCgl_out_annual_tile)
ggplot() + 
  geom_point(data=subset(data1, year>=500), aes(x=log(QMD), y=log(Density12), color=as.factor(LevelLUE))) +
  geom_smooth(data=subset(data1, year>=500), aes(x=log(QMD), y=log(Density12), color=as.factor(LevelLUE)),method = "lm",fullrange = T) +
  scale_color_manual(labels = c("Control","+15%", "+30%"),values = c("#F8766D" ,"#619CFF","#00BA38"))+
  labs(col = "Level of LUE", x = "Quadratic Mean Diameter (QMD)", y = "Stand density (N)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") + 
  ggtitle("Mortality as a function of NSC") + 
  scale_x_continuous(limits = c(2.6,3.6)) + 
  scale_y_continuous(limits = c(3.8,8.2))

# Mortality as a function of GR

data1 <- rbind(ea1sa1GRgl_out_annual_tile, ea2sa1GRgl_out_annual_tile, ea3sa1GRgl_out_annual_tile)
ggplot() + 
  geom_point(data=subset(data1, year>=500), aes(x=log(QMD), y=log(Density12), color=as.factor(LevelLUE))) +
  geom_smooth(data=subset(data1, year>=500), aes(x=log(QMD), y=log(Density12), color=as.factor(LevelLUE)),method = "lm",fullrange = T) +
  scale_color_manual(labels = c("Control","+15%", "+30%"),values = c("#F8766D" ,"#619CFF","#00BA38"))+
  labs(col = "Level of LUE", x = "Quadratic Mean Diameter (QMD)", y = "Stand density (N)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") + 
  ggtitle("Mortality as a function of GR") 


# Mortality as a function of CST

## Figure opt 1
ggplot() + 
  geom_point(data=subset(ea1sa1CSTgl_out_annual_tile,year>=500), aes(x=log(DBH), y=log(Density), color='Control')) + 
  geom_point(data=subset(ea2sa1CSTgl_out_annual_tile,year>=500), aes(x=log(DBH), y=log(Density), color='+15%')) +
  geom_point(data=subset(ea3sa1CSTgl_out_annual_tile,year>=500), aes(x=log(DBH), y=log(Density), color='+30%')) +
  scale_color_manual("Levels of LUE", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#619CFF","#00BA38"))+
  labs(col = "Level of LUE", x = "Ln(QMD)", y = "Ln(N)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Function of DBH") + 
  scale_x_continuous(limits = c(3.5,4.25)) + 
  scale_y_continuous(limits = c(4.8,6))


data1 <- rbind(ea1sa1CSTgl_out_annual_tile, ea2sa1CSTgl_out_annual_tile, ea3sa1CSTgl_out_annual_tile)
ggplot() + 
  geom_point(data=subset(data1, year>=38), aes(x=log(QMD), y=log(Density12), color=as.factor(LevelLUE))) +
  geom_smooth(data=subset(data1, year>=25), aes(x=log(QMD), y=log(Density12), color=as.factor(LevelLUE)),method = "lm",fullrange = T) +
  scale_color_manual(labels = c("Control","+15%", "+30%"),values = c("#F8766D" ,"#619CFF","#00BA38"))+
  labs(col = "Level of LUE", x = "Quadratic Mean Diameter (QMD)", y = "Stand density (N)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") + 
  ggtitle("Mortality as a function of GR") 

```





## PAR levels

### Stand develop: Stand biomass vs. time

```{r}

# Mortality DBH
# Biomass changes in PAR with WD level 1
ggplot() + 
  geom_line(data=eb1sa1magl_out_annual_tile, aes(x=year, y=plantC, color='Control')) + 
  geom_line(data=eb2sa1magl_out_annual_tile, aes(x=year, y=plantC, color='+15%')) +
  geom_line(data=eb3sa1magl_out_annual_tile, aes(x=year, y=plantC, color='+30%')) +
  scale_color_manual("Levels of PAR", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Mortality formulation DBH")

# Mortality Ratio NSC and Leaf Mass
# Biomass changes in PAR with WD level 1
ggplot() + 
  geom_line(data=eb1sa1mb_out_annual_tile, aes(x=year, y=plantC, color='Control')) + 
  geom_line(data=eb2sa1mb_out_annual_tile, aes(x=year, y=plantC, color='+15%')) +
  geom_line(data=eb3sa1mb_out_annual_tile, aes(x=year, y=plantC, color='+30%')) +
  scale_color_manual("Levels of PAR", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Mortality formulation Ratio NSC - Leaf mass")

# Mortality Growth rate
# Biomass changes in PAR with WD level 1
ggplot() + 
  geom_line(data=eb1sa1mc_out_annual_tile, aes(x=year, y=plantC, color='Control')) + 
  geom_line(data=eb2sa1mc_out_annual_tile, aes(x=year, y=plantC, color='+15%')) +
  geom_line(data=eb3sa1mc_out_annual_tile, aes(x=year, y=plantC, color='+30%')) +
  scale_color_manual("Levels of PAR", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Mortality formulation Growth rate")

# Mortality Constant Self-thinning
# Biomass changes in PAR with WD level 1
ggplot() + 
  geom_line(data=eb1sa1md_out_annual_tile, aes(x=year, y=plantC, color='Control')) + 
  geom_line(data=eb2sa1md_out_annual_tile, aes(x=year, y=plantC, color='+15%')) +
  geom_line(data=eb3sa1md_out_annual_tile, aes(x=year, y=plantC, color='+30%')) +
  scale_color_manual("Levels of PAR", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Mortality formulation Growth rate")

```

### Arrange figures

```{r, fig.width = 10, fig.height = 4}

## All mortality form with facet_wrap
data1 <- rbind(eb1sa1magl_out_annual_tile, eb2sa1magl_out_annual_tile, eb3sa1magl_out_annual_tile,
               eb1sa1mbgl_out_annual_tile, eb2sa1mbgl_out_annual_tile, eb3sa1mbgl_out_annual_tile,
               eb1sa1mcgl_out_annual_tile, eb2sa1mcgl_out_annual_tile, eb3sa1mcgl_out_annual_tile,
               eb1sa1mdgl_out_annual_tile, eb2sa1mdgl_out_annual_tile, eb3sa1mdgl_out_annual_tile)

data1$Mortality <- factor(data1$Mortality, levels = c("DBH", "C starvation", "Growth rate", "Constant Self-thinning"))

ggplot(data=data1) +
  geom_line(aes(x=year, y=plantC,color=as.factor(LevelLUE))) + facet_wrap(~ Mortality, ncol=4)+
  scale_color_manual(labels = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(col = "Levels of PAR",x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

```

## Wood density levels

### Stand develop: Stand biomass vs. time

```{r}

# Mortality DBH
# Biomass changes in WD with LUE level 1
ggplot() + 
  geom_line(data=ea1sa1ma_out_annual_tile, aes(x=year, y=plantC, color='300 kgC m-3')) + 
  geom_line(data=ea1sa2ma_out_annual_tile, aes(x=year, y=plantC, color='600 kgC m-3')) +
  geom_line(data=ea1sa3ma_out_annual_tile, aes(x=year, y=plantC, color='800 kgC m-3')) +
  scale_color_manual("Levels of WD", breaks = c("300 kgC m-3", "600 kgC m-3", "800 kgC m-3"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Mortality formulation DBH")

# Mortality Ratio NSC and Leaf Mass
# Biomass changes in WD with LUE level 1
ggplot() + 
  geom_line(data=ea1sa1mb_out_annual_tile, aes(x=year, y=plantC, color='300 kgC m-3')) + 
  geom_line(data=ea1sa2mb_out_annual_tile, aes(x=year, y=plantC, color='600 kgC m-3')) +
  geom_line(data=ea1sa3mb_out_annual_tile, aes(x=year, y=plantC, color='800 kgC m-3')) +
  scale_color_manual("Levels of WD", breaks = c("300 kgC m-3", "600 kgC m-3", "800 kgC m-3"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Mortality formulation Ratio NSC - Leaf mass")

# Mortality Growth rate
# Biomass changes in WD with LUE level 1
ggplot() + 
  geom_line(data=ea1sa1mc_out_annual_tile, aes(x=year, y=plantC, color='300 kgC m-3')) + 
  geom_line(data=ea1sa2mc_out_annual_tile, aes(x=year, y=plantC, color='600 kgC m-3')) +
  geom_line(data=ea1sa3mc_out_annual_tile, aes(x=year, y=plantC, color='800 kgC m-3')) +
  scale_color_manual("Levels of WD", breaks = c("300 kgC m-3", "600 kgC m-3", "800 kgC m-3"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Mortality formulation Growth rate")

# Mortality Self-thinning
# Biomass changes in WD with LUE level 1
ggplot() + 
  geom_line(data=ea1sa1md_out_annual_tile, aes(x=year, y=plantC, color='300 kgC m-3')) + 
  geom_line(data=ea1sa2md_out_annual_tile, aes(x=year, y=plantC, color='600 kgC m-3')) +
  geom_line(data=ea1sa3md_out_annual_tile, aes(x=year, y=plantC, color='800 kgC m-3')) +
  scale_color_manual("Levels of WD", breaks = c("300 kgC m-3", "600 kgC m-3", "800 kgC m-3"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Mortality formulation Constant Self-thinning")

```

### Arrange figures

```{r, fig.width = 10, fig.height = 4}

## All mortality form with facet_wrap
data1 <- rbind(ea1sa1ma_out_annual_tile, ea1sa2ma_out_annual_tile, ea1sa3ma_out_annual_tile,
               ea1sa1mb_out_annual_tile, ea1sa2mb_out_annual_tile, ea1sa3mb_out_annual_tile,
               ea1sa1mc_out_annual_tile, ea1sa2mc_out_annual_tile, ea1sa3mc_out_annual_tile,
               ea1sa1md_out_annual_tile, ea1sa2md_out_annual_tile, ea1sa3md_out_annual_tile)

data1$Mortality <- factor(data1$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate", "Constant Self-thinning"))

ggplot(data=data1) +
  geom_line(aes(x=year, y=plantC,color=as.factor(LevelWD))) + facet_wrap(~ Mortality, ncol=4)+
  scale_color_manual(labels = c("300 kgC m-3", "600 kgC m-3", "800 kgC m-3"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(col = "Levels of WD",x = "Slope of B ~ t", y = expression(paste("Mean biomass at maturity (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

```

## Root:Shoot ratio levels

### Stand develop: Stand biomass vs. time

```{r}

# Biomass changes in RS with LUE level 1
# Mortality DBH
ggplot() + 
  geom_line(data=ea1sb1ma_out_annual_tile, aes(x=year, y=plantC, color='phiRL = 4')) + 
  geom_line(data=ea1sb2ma_out_annual_tile, aes(x=year, y=plantC, color='phiRL = 5')) +
  geom_line(data=ea1sb3ma_out_annual_tile, aes(x=year, y=plantC, color='phiRL = 6')) +
  scale_color_manual("Levels of R:S", breaks = c("phiRL = 4", "phiRL = 5", "phiRL = 6"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Mortality formulation DBH")

# Biomass changes in RS with LUE level 1
# Mortality Ratio NSC and Leaf Mass
ggplot() + 
  geom_line(data=ea1sb1mb_out_annual_tile, aes(x=year, y=plantC, color='phiRL = 4')) + 
  geom_line(data=ea1sb2mb_out_annual_tile, aes(x=year, y=plantC, color='phiRL = 5')) +
  geom_line(data=ea1sb3mb_out_annual_tile, aes(x=year, y=plantC, color='phiRL = 6')) +
  scale_color_manual("Levels of R:S", breaks = c("phiRL = 4", "phiRL = 5", "phiRL = 6"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Mortality formulation Ratio NSC - Leaf mass")

# Biomass changes in RS with LUE level 1
# Mortality Growth rate
ggplot() + 
  geom_line(data=ea1sb1mc_out_annual_tile, aes(x=year, y=plantC, color='phiRL = 4')) +  
  geom_line(data=ea1sb2mc_out_annual_tile, aes(x=year, y=plantC, color='phiRL = 5')) +
  geom_line(data=ea1sb3mc_out_annual_tile, aes(x=year, y=plantC, color='phiRL = 6')) +
  scale_color_manual("Levels of R:S", breaks = c("phiRL = 4", "phiRL = 5", "phiRL = 6"), values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(x = "Year", y = expression(paste("Biomass (Kg C ", m^-2, " ", yr^-1, ") "))) + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") +
  ggtitle("Mortality formulation Growth rate")

```





```{r, fig.width = 10, fig.height = 4}

data1 <- rbind(ea1sa1ma_out_annual_tile, ea2sa1ma_out_annual_tile, ea3sa1ma_out_annual_tile,
               ea1sa1mb_out_annual_tile, ea2sa1mb_out_annual_tile, ea3sa1mb_out_annual_tile,
               ea1sa1mc_out_annual_tile, ea2sa1mc_out_annual_tile, ea3sa1mc_out_annual_tile,
               ea1sa1md_out_annual_tile, ea2sa1md_out_annual_tile, ea3sa1md_out_annual_tile)

data1$Mortality <- factor(data1$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate","Constant Self-thinning"))

ggplot() + 
  geom_line(data=data1, aes(x=year, y=CAI, color=as.factor(LevelLUE))) + facet_wrap(~ Mortality, ncol=4)+
  scale_color_discrete(labels = c(`1` = "Control", `2` = "+15%", `3` = "+30%"),name = "Levels of LUE", guide = "legend")+
  labs(x = "Year", y = "CAI") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") 

data1 <- rbind(ea1sa1ma_out_annual_tile, ea1sa2ma_out_annual_tile, ea1sa3ma_out_annual_tile,
               ea1sa1mb_out_annual_tile, ea1sa2mb_out_annual_tile, ea1sa3mb_out_annual_tile,
               ea1sa1mc_out_annual_tile, ea1sa2mc_out_annual_tile, ea1sa3mc_out_annual_tile,
               ea1sa1md_out_annual_tile, ea1sa2md_out_annual_tile, ea1sa3md_out_annual_tile)

data1$Mortality <- factor(data1$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate","Constant Self-thinning"))

ggplot() + 
  geom_line(data=data1, aes(x=year, y=CAI, color=as.factor(LevelWD))) + facet_wrap(~ Mortality, ncol=4)+
  scale_color_manual(labels = c("300 kgC m-3","600 kgC m-3", "800 kgC m-3"),values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(col = "Level of WD", x = "Year", y = "CAI") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom") 

```




# Annual_cohort_output
#### Distribution of tree sizes

From annual_cohort_output: dbh class 

##### LUE
```{r, fig.width = 6, fig.height = 9}
dataforplot <- rbind(ea1sa1magl_out_annual_cohorts,ea2sa1magl_out_annual_cohorts,ea3sa1magl_out_annual_cohorts)

ggplot(subset(dataforplot,dbhclass!="[0,0.12]")) + geom_bar(aes(fill=as.factor(LevelLUE), x=dbhclass, y=density), position="dodge", stat="identity")+
    labs(x = "DBH class (m)", y = expression(paste("Density (indiv", " " ,ha^-1, ") "))) +
    scale_fill_discrete(labels = c(`1` = "Control", `2` = "+15%", `3` = "+30%"),name = "Levels of LUE at WD 1", guide = "legend") + 
    theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

ggplot(subset(dataforplot,ageclass!="[0,10]"&ageclass!="(10,20]")) + geom_bar(aes(fill=as.factor(LevelLUE), x=ageclass, y=density), position="dodge", stat="identity")+
    labs(x = "Age class (yrs)", y = expression(paste("Density (indiv", " " ,ha^-1, ") "))) +
    scale_fill_discrete(labels = c(`1` = "Control", `2` = "+15%", `3` = "+30%"),name = "Levels of LUE at WD 1", guide = "legend") + 
    theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

data1 <- rbind(ea1sa1ma_out_annual_cohorts, ea2sa1ma_out_annual_cohorts, ea3sa1ma_out_annual_cohorts,
               ea1sa1mb_out_annual_cohorts, ea2sa1mb_out_annual_cohorts, ea3sa1mb_out_annual_cohorts,
               ea1sa1mc_out_annual_cohorts, ea2sa1mc_out_annual_cohorts, ea3sa1mc_out_annual_cohorts)

data1$Mortality <- factor(data1$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate"))

ggplot(data1) + geom_bar(aes(fill=as.factor(LevelLUE), x=dbhclass, y=density), position="dodge", stat="identity")+
    labs(x = "DBH class (m)", y = expression(paste("Density (indiv", " " ,ha^-1, ") "))) +
    scale_fill_discrete(labels = c(`1` = "Control", `2` = "+15%", `3` = "+30%"),name = "Levels of LUE", guide = "legend") + 
    theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  facet_wrap(~ Mortality, ncol=3)

ggplot(data1) + geom_bar(aes(fill=as.factor(LevelLUE), x=ageclass, y=density), position="dodge", stat="identity")+
    labs(x = "Age class (yrs)", y = expression(paste("Density (indiv", " " ,ha^-1, ") "))) +
    scale_fill_discrete(labels = c(`1` = "Control", `2` = "+15%", `3` = "+30%"),name = "Levels of LUE", guide = "legend") + 
    theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
    facet_wrap(~ Mortality, ncol=3)

ggplot(subset(data1,dbhclass!="[0,0.12]")) + geom_bar(aes(fill=as.factor(LevelLUE), x=dbhclass, y=density), position="dodge", stat="identity")+
    labs(x = "DBH class (m)", y = expression(paste("Density (indiv", " " ,ha^-1, ") "))) +
    scale_fill_discrete(labels = c(`1` = "Control", `2` = "+15%", `3` = "+30%"),name = "Levels of LUE", guide = "legend") + 
    theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  facet_wrap(~ Mortality, ncol=1)

ggplot(subset(data1,ageclass!="[0,10]"&ageclass!="(10,20]"&ageclass!="(20,30]"&ageclass!="(30,40]")) + geom_bar(aes(fill=as.factor(LevelLUE), x=ageclass, y=density), position="dodge", stat="identity")+
    labs(x = "Age class (yrs)", y = expression(paste("Density (indiv", " " ,ha^-1, ") "))) +
    scale_fill_discrete(labels = c(`1` = "Control", `2` = "+15%", `3` = "+30%"),name = "Levels of LUE", guide = "legend") + 
    theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
    facet_wrap(~ Mortality, ncol=1)
```



#### Size bin (x, biomass, volume) vs. Growth (y, volume or mass increment per year); data = individual-level

From annual_cohort_output: dbh class NPP_yr

##### LUE
```{r, fig.width = 6, fig.height = 9}
library(dplyr)
library(forcats)
library(ggridges)

# Plot geom_density_ridges

dataBinLUE <- rbind(ea1sa1mc_out_annual_cohorts[,c(28,23,32,33,34,35)], ea2sa1mc_out_annual_cohorts[,c(28,23,32,33,34,35)], ea3sa1mc_out_annual_cohorts[,c(28,23,32,33,34,35)])

ggplot(dataBinLUE) +  geom_density_ridges(aes(NPP_yr,dbhclass,fill = paste(LevelLUE)),alpha = .6, color = "white")+
  labs(x = expression(paste("NPP (Kg C ", m^-2, " " ,yr^-1, ") ")), y = " DBH class (m)") +
  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") +
  scale_fill_cyclical(labels = c(`1` = "Control", `2` = "+15%", `3` = "+30%"),values = c("#F8766D", "#00BA38", "#619CFF"),
  name = "Levels of LUE", guide = "legend") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

data1 <- rbind(ea1sa1ma_out_annual_cohorts, ea2sa1ma_out_annual_cohorts, ea3sa1ma_out_annual_cohorts,
               ea1sa1mb_out_annual_cohorts, ea2sa1mb_out_annual_cohorts, ea3sa1mb_out_annual_cohorts,
               ea1sa1mc_out_annual_cohorts, ea2sa1mc_out_annual_cohorts, ea3sa1mc_out_annual_cohorts)

data1$Mortality <- factor(data1$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate"))

data1DBHClass <- data1 %>% group_by(dbhclass,Mortality,LevelLUE) %>% summarize(NPP_yr_aggr = mean(NPP_yr),NPP_yr_sd = sd(NPP_yr)) 

ggplot(data1) +  geom_density_ridges(aes(NPP_yr,dbhclass,fill = paste(LevelLUE)),alpha = .6, color = "white")+
  labs(x = expression(paste("NPP (Kg C ", m^-2, " " ,yr^-1, ") ")), y = " DBH class (m)") +
  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") +
  scale_fill_cyclical(labels = c(`1` = "Control", `2` = "+15%", `3` = "+30%"),values = c("#F8766D", "#00BA38", "#619CFF"),
  name = "Levels of LUE", guide = "legend") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  facet_wrap(~ Mortality, ncol=1)

ggplot() + 
  geom_point(data=data1DBHClass, aes(x=dbhclass, y=NPP_yr_aggr, color=as.factor(LevelLUE))) +
  geom_errorbar(data=data1DBHClass, aes(x=dbhclass, ymin=NPP_yr_aggr-NPP_yr_sd,ymax=NPP_yr_aggr+NPP_yr_sd,color=as.factor(LevelLUE)),width=0) +
  scale_color_manual(labels = c("Control","+15%", "+30%"),values = c("#F8766D", "#00BA38", "#619CFF"))+
  labs(col = "Level of LUE",y = expression(paste("NPP (Kg C ", m^-2, " " ,yr^-1, ") ")), x = "DBH class (m)") +
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  facet_wrap(~ Mortality, ncol=3)

# Plot relative enhancement: NPP(level 2) / NPP(level 1) [and NPP(level 3) / NPP(level 1)] per size bin

#ggplot(dataBinLUE_cohortsDBHClassJoin_2_1_ma) +  geom_density_ridges(aes(RelEnan2_1,dbhclass),alpha = .6, color = "white", fill="#00BA38")+
#  labs(x = expression(paste(NPP[LUE_2], " / " ,NPP[LUE_1])), y = " DBH class (m)") +
#  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") 

#ggplot(dataBinLUE_cohortsDBHClassJoin_3_1_ma) +  geom_density_ridges(aes(RelEnan3_1,dbhclass),alpha = .6, color = "white", fill="#619CFF")+
#  labs(x = expression(paste(NPP[LUE_3], " / " ,NPP[LUE_1])), y = " DBH class (m)") +
#  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") 

data2 <- rbind(dataBinLUE_cohortsDBHClassJoin_2_1_ma, dataBinLUE_cohortsDBHClassJoin_2_1_mb, dataBinLUE_cohortsDBHClassJoin_2_1_mc)
data2$Mortality <- factor(data2$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate"))

#ggplot(data2) + geom_density_ridges(aes(RelEnan2_1,dbhclass),alpha = .6, color = "white", fill="#00BA38")+
#  labs(x = expression(paste(NPP[LUE_2], " / " ,NPP[LUE_1])), y = " DBH class (m)") +
#  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") + facet_wrap(~ Mortality, ncol=3)

ggplot(data2) + geom_point(aes(dbhclass,RelEnan2_1),color="#00BA38")+
 labs(y = expression(paste(NPP[LUE_2], " / " ,NPP[LUE_1])), x = " DBH class (m)") + 
 theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
 facet_wrap(~ Mortality, ncol=3) + geom_hline(yintercept=1, linetype="dashed", color = "grey")

data3 <- rbind(dataBinLUE_cohortsDBHClassJoin_3_1_ma, dataBinLUE_cohortsDBHClassJoin_3_1_mb, dataBinLUE_cohortsDBHClassJoin_3_1_mc)
data3$Mortality <- factor(data3$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate"))

#ggplot(data3) + geom_density_ridges(aes(RelEnan3_1,dbhclass),alpha = .6, color = "white", fill="#619CFF")+
#  labs(x = expression(paste(NPP[LUE_3], " / " ,NPP[LUE_1])), y = " DBH class (m)") +
#  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") + facet_wrap(~ Mortality, ncol=3)

ggplot(data3) + geom_point(aes(dbhclass,RelEnan3_1),color="#619CFF")+
  labs(y = expression(paste(NPP[LUE_3], " / " ,NPP[LUE_1])), x = " DBH class (m)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  facet_wrap(~ Mortality, ncol=3) + geom_hline(yintercept=1, linetype="dashed", color = "grey")

```

##### PAR
```{r, fig.width = 6, fig.height = 9}

# Plot geom_density_ridges

dataBinPAR <- rbind(eb1sa1mb_out_annual_cohorts[,c(28,23,32,33,34,35)], eb2sa1mb_out_annual_cohorts[,c(28,23,32,33,34,35)], eb3sa1mb_out_annual_cohorts[,c(28,23,32,33,34,35)])

ggplot(dataBinPAR) +  geom_density_ridges(aes(NPP_yr,dbhclass,fill = paste(LevelPAR)),alpha = .6, color = "white")+
  labs(x = expression(paste("NPP (Kg C ", m^-2, " " ,yr^-1, ") ")), y = " DBH class (m)") +
  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") +
  scale_fill_cyclical(labels = c(`1` = "Control", `2` = "+15%", `3` = "+30%"),values = c("#F8766D", "#00BA38", "#619CFF"),
  name = "Levels of PAR", guide = "legend") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

data1 <- rbind(eb1sa1ma_out_annual_cohorts, eb2sa1ma_out_annual_cohorts, eb3sa1ma_out_annual_cohorts,
               eb1sa1mb_out_annual_cohorts, eb2sa1mb_out_annual_cohorts, eb3sa1mb_out_annual_cohorts,
               eb1sa1mc_out_annual_cohorts, eb2sa1mc_out_annual_cohorts, eb3sa1mc_out_annual_cohorts)

data1$Mortality <- factor(data1$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate"))

data1DBHClass <- data1 %>% group_by(dbhclass,Mortality,LevelPAR) %>% summarize(NPP_yr_aggr = mean(NPP_yr),NPP_yr_sd = sd(NPP_yr)) 

ggplot(data1) +  geom_density_ridges(aes(NPP_yr,dbhclass,fill = paste(LevelPAR)),alpha = .6, color = "white")+
  labs(x = expression(paste("NPP (Kg C ", m^-2, " " ,yr^-1, ") ")), y = " DBH class (m)") +
  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") +
  scale_fill_cyclical(labels = c(`1` = "Control", `2` = "+15%", `3` = "+30%"),values = c("#F8766D", "#00BA38", "#619CFF"),
  name = "Levels of PAR", guide = "legend") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  facet_wrap(~ Mortality, ncol=1)

ggplot() + 
  geom_point(data=data1DBHClass, aes(x=dbhclass, y=NPP_yr_aggr, color=as.factor(LevelPAR))) +
  geom_errorbar(data=data1DBHClass, aes(x=dbhclass, ymin=NPP_yr_aggr-NPP_yr_sd,ymax=NPP_yr_aggr+NPP_yr_sd,color=as.factor(LevelPAR)),width=0) +
  scale_color_manual(labels = c("Control","+15%", "+30%"),values = c("#F8766D", "#00BA38", "#619CFF"))+
  labs(col = "Level of PAR",y = expression(paste("NPP (Kg C ", m^-2, " " ,yr^-1, ") ")), x = "DBH class (m)") +
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  facet_wrap(~ Mortality, ncol=1)

# Plot relative enhancement: NPP(level 2) / NPP(level 1) [and NPP(level 3) / NPP(level 1)] per size bin

ggplot(dataBinPAR_cohortsDBHClassJoin_2_1_ma) +  geom_density_ridges(aes(RelEnan2_1,dbhclass),alpha = .6, color = "white", fill="#00BA38")+
  labs(x = expression(paste(NPP[PAR_2], " / " ,NPP[PAR_1])), y = " DBH class (m)") +
  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") 

ggplot(dataBinPAR_cohortsDBHClassJoin_3_1_ma) +  geom_density_ridges(aes(RelEnan3_1,dbhclass),alpha = .6, color = "white", fill="#619CFF")+
  labs(x = expression(paste(NPP[PAR_3], " / " ,NPP[PAR_1])), y = " DBH class (m)") +
  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") 

data2 <- rbind(dataBinPAR_cohortsDBHClassJoin_2_1_ma, dataBinPAR_cohortsDBHClassJoin_2_1_mb, dataBinPAR_cohortsDBHClassJoin_2_1_mc)
data2$Mortality <- factor(data2$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate"))

#ggplot(data2) + geom_density_ridges(aes(RelEnan2_1,dbhclass),alpha = .6, color = "white", fill="#00BA38")+
#  labs(x = expression(paste(NPP[PAR_2], " / " ,NPP[PAR_1])), y = " DBH class (m)") +
#  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") + facet_wrap(~ Mortality, ncol=3)

ggplot(data2) + geom_point(aes(dbhclass,RelEnan2_1),color="#00BA38")+
  labs(y = expression(paste(NPP[PAR_2], " / " ,NPP[PAR_1])), x = " DBH class (m)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  facet_wrap(~ Mortality, ncol=1) + geom_hline(yintercept=1, linetype="dashed", color = "grey")

data3 <- rbind(dataBinPAR_cohortsDBHClassJoin_3_1_ma, dataBinPAR_cohortsDBHClassJoin_3_1_mb, dataBinPAR_cohortsDBHClassJoin_3_1_mc)
data3$Mortality <- factor(data3$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate"))

#ggplot(data3) + geom_density_ridges(aes(RelEnan3_1,dbhclass),alpha = .6, color = "white", fill="#619CFF")+
#  labs(x = expression(paste(NPP[PAR_3], " / " ,NPP[PAR_1])), y = " DBH class (m)") +
#  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") + facet_wrap(~ Mortality, ncol=3)

ggplot(data3) + geom_point(aes(dbhclass,RelEnan3_1),color="#619CFF")+
  labs(y = expression(paste(NPP[PAR_3], " / " ,NPP[PAR_1])), x = " DBH class (m)") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  facet_wrap(~ Mortality, ncol=1) + geom_hline(yintercept=1, linetype="dashed", color = "grey")

```

#### Light bin (x, sum of basal area of trees with higher basal area than current one) vs. Growth (y, volume or mass increment per year); data = individual-level

From annual_cohort_output: dbh and NPP_yr

##### LUE
```{r, fig.width = 6, fig.height = 9}

# Plot geom_density_ridges

dataBinLUE <- rbind(ea1sa1ma_out_annual_cohorts[,c(28,23,32,33,34,35)], ea2sa1ma_out_annual_cohorts[,c(28,23,32,33,34,35)], ea3sa1ma_out_annual_cohorts[,c(28,23,32,33,34,35)])

ggplot(dataBinLUE) +  geom_density_ridges(aes(NPP_yr,highBAclass,fill = paste(LevelLUE)),alpha = .6, color = "white")+
  labs(x = expression(paste("NPP (Kg C ", m^-2, " " ,yr^-1, ") ")), y = expression(paste("Sum BA of higher trees (", m^2, " " ,ha^-1, ") "))) +
  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") +
  scale_fill_cyclical(labels = c(`1` = "Control", `2` = "+15%", `3` = "+30%"),values = c("#F8766D", "#00BA38", "#619CFF"),
  name = "Levels of LUE", guide = "legend") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

data1 <- rbind(ea1sa1ma_out_annual_cohorts, ea2sa1ma_out_annual_cohorts, ea3sa1ma_out_annual_cohorts,
               ea1sa1mb_out_annual_cohorts, ea2sa1mb_out_annual_cohorts, ea3sa1mb_out_annual_cohorts,
               ea1sa1mc_out_annual_cohorts, ea2sa1mc_out_annual_cohorts, ea3sa1mc_out_annual_cohorts)

data1$Mortality <- factor(data1$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate"))

ggplot(data1) +  geom_density_ridges(aes(NPP_yr,highBAclass,fill = paste(LevelLUE)),alpha = .6, color = "white")+
  labs(x = expression(paste("NPP (Kg C ", m^-2, " " ,yr^-1, ") ")), y = expression(paste("Sum BA of higher trees (", m^2, " " ,ha^-1, ") "))) +
  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") +
  scale_fill_cyclical(labels = c(`1` = "Control", `2` = "+15%", `3` = "+30%"),values = c("#F8766D", "#00BA38", "#619CFF"),
  name = "Levels of LUE", guide = "legend") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  facet_wrap(~ Mortality, ncol=1)

data1highBAClass <- data1 %>% group_by(highBAclass,Mortality,LevelLUE) %>% summarize(NPP_yr_aggr = mean(NPP_yr),NPP_yr_sd = sd(NPP_yr)) 
data1highBAClass$Mortality <- factor(data1highBAClass$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate"))

ggplot() + 
  geom_point(data=data1highBAClass, aes(x=highBAclass, y=NPP_yr_aggr, color=as.factor(LevelLUE))) +
  geom_errorbar(data=data1highBAClass, aes(x=highBAclass, ymin=NPP_yr_aggr-NPP_yr_sd,ymax=NPP_yr_aggr+NPP_yr_sd,color=as.factor(LevelLUE)),width=0) +
  scale_color_manual(labels = c("Control","+15%", "+30%"),values = c("#F8766D", "#00BA38", "#619CFF"))+
  labs(col = "Level of LUE",y = expression(paste("NPP (Kg C ", m^-2, " " ,yr^-1, ") ")), x = expression(paste("Sum BA of higher trees (", m^2, " " ,ha^-1, ") "))) +
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  facet_wrap(~ Mortality, ncol=1)

# Plot relative enhancement: NPP(level 2) / NPP(level 1) [and NPP(level 3) / NPP(level 1)] per size bin

data2 <- rbind(dataBinLUE_cohortsHighBAClassJoin_2_1_ma, dataBinLUE_cohortsHighBAClassJoin_2_1_mb, dataBinLUE_cohortsHighBAClassJoin_2_1_mc)
data2$Mortality <- factor(data2$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate"))

#ggplot(data2) + geom_density_ridges(aes(RelEnan2_1,highBAclass),alpha = .6, color = "white", fill="#00BA38")+
#  labs(x = expression(paste(NPP[LUE_2], " / " ,NPP[LUE_1])), y = expression(paste("Sum BA of higher trees (", m^2, " " ,ha^-1, ") "))) +
#  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") + facet_wrap(~ Mortality, ncol=1)

ggplot(data2) + geom_point(aes(highBAclass,RelEnan2_1),color="#00BA38")+
  labs(y = expression(paste(NPP[LUE_2], " / " ,NPP[LUE_1])), x = expression(paste("Sum BA of higher trees (", m^2, " " ,ha^-1, ") "))) +
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  facet_wrap(~ Mortality, ncol=1) + geom_hline(yintercept=1, linetype="dashed", color = "grey")

data3 <- rbind(dataBinLUE_cohortsHighBAClassJoin_3_1_ma, dataBinLUE_cohortsHighBAClassJoin_3_1_mb, dataBinLUE_cohortsHighBAClassJoin_3_1_mc)
data3$Mortality <- factor(data3$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate"))

#ggplot(data3) + geom_density_ridges(aes(RelEnan3_1,highBAclass),alpha = .6, color = "white", fill="#619CFF")+
#  labs(x = expression(paste(NPP[LUE_3], " / " ,NPP[LUE_1])), y = expression(paste("Sum BA of higher trees (", m^2, " " ,ha^-1, ") "))) +
#  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") + facet_wrap(~ Mortality, ncol=1)

ggplot(data3) + geom_point(aes(highBAclass,RelEnan3_1),color="#619CFF")+
  labs(y = expression(paste(NPP[LUE_3], " / " ,NPP[LUE_1])), x = expression(paste("Sum BA of higher trees (", m^2, " " ,ha^-1, ") "))) +
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  facet_wrap(~ Mortality, ncol=1) + geom_hline(yintercept=1, linetype="dashed", color = "grey")

```

##### PAR
```{r, fig.width = 6, fig.height = 9}

# Plot geom_density_ridges

dataBinPAR <- rbind(eb1sa1ma_out_annual_cohorts[,c(28,23,32,33,34,35)], eb2sa1ma_out_annual_cohorts[,c(28,23,32,33,34,35)], eb3sa1ma_out_annual_cohorts[,c(28,23,32,33,34,35)])

ggplot(dataBinPAR) +  geom_density_ridges(aes(NPP_yr,highBAclass,fill = paste(LevelPAR)),alpha = .6, color = "white")+
  labs(x = expression(paste("NPP (Kg C ", m^-2, " " ,yr^-1, ") ")), y = expression(paste("Sum BA of higher trees (", m^2, " " ,ha^-1, ") "))) +
  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") +
  scale_fill_cyclical(labels = c(`1` = "Control", `2` = "+15%", `3` = "+30%"),values = c("#F8766D", "#00BA38", "#619CFF"),
  name = "Levels of PAR", guide = "legend") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")

data1 <- rbind(eb1sa1ma_out_annual_cohorts, eb2sa1ma_out_annual_cohorts, eb3sa1ma_out_annual_cohorts,
               eb1sa1mb_out_annual_cohorts, eb2sa1mb_out_annual_cohorts, eb3sa1mb_out_annual_cohorts,
               eb1sa1mc_out_annual_cohorts, eb2sa1mc_out_annual_cohorts, eb3sa1mc_out_annual_cohorts)

data1$Mortality <- factor(data1$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate"))

ggplot(data1) +  geom_density_ridges(aes(NPP_yr,highBAclass,fill = paste(LevelPAR)),alpha = .6, color = "white")+
  labs(x = expression(paste("NPP (Kg C ", m^-2, " " ,yr^-1, ") ")), y = expression(paste("Sum BA of higher trees (", m^2, " " ,ha^-1, ") "))) +
  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") +
  scale_fill_cyclical(labels = c(`1` = "Control", `2` = "+15%", `3` = "+30%"),values = c("#F8766D", "#00BA38", "#619CFF"),
  name = "Levels of PAR", guide = "legend") + 
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  facet_wrap(~ Mortality, ncol=3)

data1highBAClass <- data1 %>% group_by(highBAclass,Mortality,LevelPAR) %>% summarize(NPP_yr_aggr = mean(NPP_yr),NPP_yr_sd = sd(NPP_yr)) 
data1highBAClass$Mortality <- factor(data1highBAClass$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate"))

ggplot() + 
  geom_point(data=data1highBAClass, aes(x=highBAclass, y=NPP_yr_aggr, color=as.factor(LevelPAR))) +
  geom_errorbar(data=data1highBAClass, aes(x=highBAclass, ymin=NPP_yr_aggr-NPP_yr_sd,ymax=NPP_yr_aggr+NPP_yr_sd,color=as.factor(LevelPAR)),width=0) +
  scale_color_manual(labels = c("Control","+15%", "+30%"),values = c("#F8766D", "#00BA38", "#619CFF"))+
  labs(col = "Level of PAR",y = expression(paste("NPP (Kg C ", m^-2, " " ,yr^-1, ") ")), x = expression(paste("Sum BA of higher trees (", m^2, " " ,ha^-1, ") "))) +
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  facet_wrap(~ Mortality, ncol=1)

# Plot relative enhancement: NPP(level 2) / NPP(level 1) [and NPP(level 3) / NPP(level 1)] per size bin

data2 <- rbind(dataBinPAR_cohortsHighBAClassJoin_2_1_ma, dataBinPAR_cohortsHighBAClassJoin_2_1_mb, dataBinPAR_cohortsHighBAClassJoin_2_1_mc)
data2$Mortality <- factor(data2$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate"))

#ggplot(data2) + geom_density_ridges(aes(RelEnan2_1,highBAclass),alpha = .6, color = "white", fill="#00BA38")+
#  labs(x = expression(paste(NPP[PAR_2], " / " ,NPP[PAR_1])), y = expression(paste("Sum BA of higher trees (", m^2, " " ,ha^-1, ") "))) +
#  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") + facet_wrap(~ Mortality, ncol=3)

ggplot(data2) + geom_point(aes(highBAclass,RelEnan2_1),color="#00BA38")+
  labs(y = expression(paste(NPP[PAR_2], " / " ,NPP[PAR_1])), x = expression(paste("Sum BA of higher trees (", m^2, " " ,ha^-1, ") "))) +
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  facet_wrap(~ Mortality, ncol=1) + geom_hline(yintercept=1, linetype="dashed", color = "grey")

data3 <- rbind(dataBinPAR_cohortsHighBAClassJoin_3_1_ma, dataBinPAR_cohortsHighBAClassJoin_3_1_mb, dataBinPAR_cohortsHighBAClassJoin_3_1_mc)
data3$Mortality <- factor(data3$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate"))

#ggplot(data3) + geom_density_ridges(aes(RelEnan3_1,highBAclass),alpha = .6, color = "white", fill="#619CFF")+
#  labs(x = expression(paste(NPP[PAR_1], " / " ,NPP[PAR_1])), y = expression(paste("Sum BA of higher trees (", m^2, " " ,ha^-1, ") "))) +
#  scale_y_discrete(expand = c(0, 0)) +  scale_x_continuous(expand = c(0, 0)) + coord_cartesian(clip = "off") + facet_wrap(~ Mortality, ncol=3)

ggplot(data3) + geom_point(aes(highBAclass,RelEnan3_1),color="#619CFF")+
  labs(y = expression(paste(NPP[PAR_3], " / " ,NPP[PAR_1])), x = expression(paste("Sum BA of higher trees (", m^2, " " ,ha^-1, ") "))) +
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  facet_wrap(~ Mortality, ncol=1) + geom_hline(yintercept=1, linetype="dashed", color = "grey")

```



##### Radiation with Age max
##### Same species at different sites (differing by LUE, growing season length, PAR)

```{r, fig.width = 8, fig.height = 4}

eb1sa1ma_out_annual_tileMaxAgg <- eb1sa1ma_out_annual_tile[500:1500,] %>% summarise(maxAge_mean=mean(MaxAge,na.rm=T), sdmaxAge=sd(MaxAge,na.rm=T),
                                  MaxVolume_MaxAge_mean=mean(MaxVolume_MaxAge,na.rm=T), sdMaxVolume_MaxAge=sd(MaxVolume_MaxAge,na.rm=T),
                                  MaxDBH_MaxAge_mean=mean(MaxDBH_MaxAge,na.rm=T), sdMaxDBH_MaxAge=sd(MaxDBH_MaxAge,na.rm=T))
eb2sa1ma_out_annual_tileMaxAgg <- eb2sa1ma_out_annual_tile[500:1500,] %>% summarise(maxAge_mean=mean(MaxAge,na.rm=T), sdmaxAge=sd(MaxAge,na.rm=T),
                                  MaxVolume_MaxAge_mean=mean(MaxVolume_MaxAge,na.rm=T), sdMaxVolume_MaxAge=sd(MaxVolume_MaxAge,na.rm=T),
                                  MaxDBH_MaxAge_mean=mean(MaxDBH_MaxAge,na.rm=T), sdMaxDBH_MaxAge=sd(MaxDBH_MaxAge,na.rm=T))
eb3sa1ma_out_annual_tileMaxAgg <- eb3sa1ma_out_annual_tile[500:1500,] %>% summarise(maxAge_mean=mean(MaxAge,na.rm=T), sdmaxAge=sd(MaxAge,na.rm=T),
                                  MaxVolume_MaxAge_mean=mean(MaxVolume_MaxAge,na.rm=T), sdMaxVolume_MaxAge=sd(MaxVolume_MaxAge,na.rm=T),
                                  MaxDBH_MaxAge_mean=mean(MaxDBH_MaxAge,na.rm=T), sdMaxDBH_MaxAge=sd(MaxDBH_MaxAge,na.rm=T))
# Volume/Age
ggplot() + 
  geom_point(data=eb1sa1ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, y=maxAge_mean, color='Control')) + geom_errorbar(data=eb1sa1ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, ymin=maxAge_mean-sdmaxAge,ymax= maxAge_mean+sdmaxAge,color='Control'),width=0)+ 
  geom_errorbar(data=eb1sa1ma_out_annual_tileMaxAgg, aes(xmin=MaxVolume_MaxAge_mean-sdMaxVolume_MaxAge,xmax= MaxVolume_MaxAge_mean+sdMaxVolume_MaxAge , y=maxAge_mean,color='Control'),width=0)+
  geom_point(data=eb2sa1ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, y=maxAge_mean, color='+15%')) + 
  geom_errorbar(data=eb2sa1ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, ymin=maxAge_mean-sdmaxAge,ymax= maxAge_mean+sdmaxAge,color='+15%'),width=0)+ geom_errorbar(data=eb2sa1ma_out_annual_tileMaxAgg, aes(xmin=MaxVolume_MaxAge_mean-sdMaxVolume_MaxAge,xmax= MaxVolume_MaxAge_mean+sdMaxVolume_MaxAge , y=maxAge_mean,color='+15%'),width=0)+
geom_point(data=eb3sa1ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, y=maxAge_mean, color='+30%')) + 
  geom_errorbar(data=eb3sa1ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, ymin=maxAge_mean-sdmaxAge,ymax=maxAge_mean+sdmaxAge,color='+30%'),width=0) +
  geom_errorbar(data=eb3sa1ma_out_annual_tileMaxAgg, aes(xmin=MaxVolume_MaxAge_mean-sdMaxVolume_MaxAge,xmax= MaxVolume_MaxAge_mean+sdMaxVolume_MaxAge , y=maxAge_mean,color='+30%'),width=0)+
  scale_color_manual("Levels of PAR at WD 1", breaks = c("Control", "+15%", "+30%"), values = c("#F8766D" ,"#00BA38", "#619CFF"))+
  labs(x = expression(paste("Growth rate (Volume ",age^-1,  ") ")), y = "Longevity") +  
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  scale_x_continuous(limits = c(0,1.75),breaks = seq(0,1.75,0.25)) + scale_y_continuous(limits = c(275, 450),breaks = seq(275, 450, 25))

# Facet wrap
data1 <- rbind(eb1sa1ma_out_annual_tile, eb2sa1ma_out_annual_tile, eb3sa1ma_out_annual_tile,
               eb1sa1mb_out_annual_tile, eb2sa1mb_out_annual_tile, eb3sa1mb_out_annual_tile,
               eb1sa1mc_out_annual_tile, eb2sa1mc_out_annual_tile, eb3sa1mc_out_annual_tile)

data1$Mortality <- factor(data1$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate"))

data1MAxAgg <- data1 %>% filter(year>=1300) %>% group_by(Mortality,LevelPAR) %>% summarise(maxAge_mean=mean(MaxAge,na.rm=T), sdmaxAge=sd(MaxAge,na.rm=T),
                                  MaxVolume_MaxAge_mean=mean(MaxVolume_MaxAge,na.rm=T), sdMaxVolume_MaxAge=sd(MaxVolume_MaxAge,na.rm=T),
                                  MaxDBH_MaxAge_mean=mean(MaxDBH_MaxAge,na.rm=T), sdMaxDBH_MaxAge=sd(MaxDBH_MaxAge,na.rm=T))
 
ggplot() + 
  geom_point(data=data1MAxAgg, aes(x=MaxVolume_MaxAge_mean, y=maxAge_mean, color=as.factor(LevelPAR))) +
  geom_errorbar(data=data1MAxAgg, aes(x=MaxVolume_MaxAge_mean, ymin=maxAge_mean-sdmaxAge,ymax=maxAge_mean+sdmaxAge,color=as.factor(LevelPAR)),width=0) +
  geom_errorbar(data=data1MAxAgg, aes(xmin=MaxVolume_MaxAge_mean-sdMaxVolume_MaxAge,xmax= MaxVolume_MaxAge_mean+sdMaxVolume_MaxAge , y=maxAge_mean,color=as.factor(LevelPAR)),width=0) +
  scale_color_manual(labels = c("Control","+15%", "+30%"),values = c("#F8766D", "#00BA38", "#619CFF"))+
  labs(col="Levels of PAR",x = expression(paste("Growth rate (Volume ",age^-1,  ") ")), y = "Longevity") +  
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  facet_wrap(~ Mortality, ncol=3)

ggplot() + 
  geom_point(data=data1MAxAgg, aes(x=MaxDBH_MaxAge_mean, y=maxAge_mean, color=as.factor(LevelPAR))) +
  geom_errorbar(data=data1MAxAgg, aes(x=MaxDBH_MaxAge_mean, ymin=maxAge_mean-sdmaxAge,ymax=maxAge_mean+sdmaxAge,color=as.factor(LevelPAR)),width=0) +
  geom_errorbar(data=data1MAxAgg, aes(xmin=MaxDBH_MaxAge_mean-sdMaxDBH_MaxAge,xmax= MaxDBH_MaxAge_mean+sdMaxDBH_MaxAge , y=maxAge_mean,color=as.factor(LevelPAR)),width=0) +
  scale_color_manual(labels = c("Control","+15%", "+30%"),values = c("#F8766D", "#00BA38", "#619CFF"))+
  labs(col="Levels of PAR",x = expression(paste("Growth rate (DBH ",age^-1,  ") ")), y = "Longevity") +  
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  facet_wrap(~ Mortality, ncol=3)
```

##### Wood density with Age max 
##### Different species at a given site: Each point is one species (differing by wood density, root:shoot ratio). Add info either by using color ~site (given LUE, growing season length, PAR).

```{r, fig.width = 8, fig.height = 4}

ea1sa1ma_out_annual_tileMaxAgg <- ea1sa1ma_out_annual_tile[500:1500,] %>% summarise(maxAge_mean=mean(MaxAge,na.rm=T), sdmaxAge=sd(MaxAge,na.rm=T),
                                  MaxVolume_MaxAge_mean=mean(MaxVolume_MaxAge,na.rm=T), sdMaxVolume_MaxAge=sd(MaxVolume_MaxAge,na.rm=T),
                                  MaxDBH_MaxAge_mean=mean(MaxDBH_MaxAge,na.rm=T), sdMaxDBH_MaxAge=sd(MaxDBH_MaxAge,na.rm=T))
ea1sa2ma_out_annual_tileMaxAgg <- ea1sa2ma_out_annual_tile[500:1500,] %>% summarise(maxAge_mean=mean(MaxAge,na.rm=T), sdmaxAge=sd(MaxAge,na.rm=T),
                                  MaxVolume_MaxAge_mean=mean(MaxVolume_MaxAge,na.rm=T), sdMaxVolume_MaxAge=sd(MaxVolume_MaxAge,na.rm=T),
                                  MaxDBH_MaxAge_mean=mean(MaxDBH_MaxAge,na.rm=T), sdMaxDBH_MaxAge=sd(MaxDBH_MaxAge,na.rm=T))
ea1sa3ma_out_annual_tileMaxAgg <- ea1sa3ma_out_annual_tile[500:1500,] %>% summarise(maxAge_mean=mean(MaxAge,na.rm=T), sdmaxAge=sd(MaxAge,na.rm=T),
                                  MaxVolume_MaxAge_mean=mean(MaxVolume_MaxAge,na.rm=T), sdMaxVolume_MaxAge=sd(MaxVolume_MaxAge,na.rm=T),
                                  MaxDBH_MaxAge_mean=mean(MaxDBH_MaxAge,na.rm=T), sdMaxDBH_MaxAge=sd(MaxDBH_MaxAge,na.rm=T))
# Volume/Age
ggplot() + 
  geom_point(data=ea1sa1ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, y=maxAge_mean, color='300 kgC m-3')) + geom_errorbar(data=ea1sa1ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, ymin=maxAge_mean-sdmaxAge,ymax= maxAge_mean+sdmaxAge,color='300 kgC m-3'),width=0)+ 
  geom_errorbar(data=ea1sa1ma_out_annual_tileMaxAgg, aes(xmin=MaxVolume_MaxAge_mean-sdMaxVolume_MaxAge,xmax= MaxVolume_MaxAge_mean+sdMaxVolume_MaxAge , y=maxAge_mean,color='300 kgC m-3'),width=0)+
  geom_point(data=ea1sa2ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, y=maxAge_mean, color='600 kgC m-3')) + 
  geom_errorbar(data=ea1sa2ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, ymin=maxAge_mean-sdmaxAge,ymax= maxAge_mean+sdmaxAge,color='600 kgC m-3'),width=0)+ geom_errorbar(data=ea1sa2ma_out_annual_tileMaxAgg, aes(xmin=MaxVolume_MaxAge_mean-sdMaxVolume_MaxAge,xmax= MaxVolume_MaxAge_mean+sdMaxVolume_MaxAge , y=maxAge_mean,color='600 kgC m-3'),width=0)+
geom_point(data=ea1sa3ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, y=maxAge_mean, color='800 kgC m-3')) + 
  geom_errorbar(data=ea1sa3ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, ymin=maxAge_mean-sdmaxAge,ymax=maxAge_mean+sdmaxAge,color='800 kgC m-3'),width=0) +
  geom_errorbar(data=ea1sa3ma_out_annual_tileMaxAgg, aes(xmin=MaxVolume_MaxAge_mean-sdMaxVolume_MaxAge,xmax= MaxVolume_MaxAge_mean+sdMaxVolume_MaxAge , y=maxAge_mean,color='800 kgC m-3'),width=0)+
  scale_color_manual("Levels of WD at LUE 1", breaks = c("300 kgC m-3", "600 kgC m-3", "800 kgC m-3"), values = c("#00AFBB" ,"#E7B800", "#FC4E07"))+
  labs(x = expression(paste("Growth rate (Volume ",age^-1,  ") ")), y = "Longevity") +  
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  scale_x_continuous(limits = c(0,1.75),breaks = seq(0,1.75,0.25)) + scale_y_continuous(limits = c(275, 450),breaks = seq(275, 450, 25))

# Facet wrap
data1 <- rbind(ea1sa1ma_out_annual_tile, ea1sa2ma_out_annual_tile, ea1sa3ma_out_annual_tile,
               ea1sa1mb_out_annual_tile, ea1sa2mb_out_annual_tile, ea1sa3mb_out_annual_tile,
               ea1sa1mc_out_annual_tile, ea1sa2mc_out_annual_tile, ea1sa3mc_out_annual_tile)

data1$Mortality <- factor(data1$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate"))

data1MAxAgg <- data1 %>% filter(year>=1300) %>% group_by(Mortality,LevelWD) %>% summarise(maxAge_mean=mean(MaxAge,na.rm=T), sdmaxAge=sd(MaxAge,na.rm=T),
                                  MaxVolume_MaxAge_mean=mean(MaxVolume_MaxAge,na.rm=T), sdMaxVolume_MaxAge=sd(MaxVolume_MaxAge,na.rm=T),
                                  MaxDBH_MaxAge_mean=mean(MaxDBH_MaxAge,na.rm=T), sdMaxDBH_MaxAge=sd(MaxDBH_MaxAge,na.rm=T))
 
ggplot() + 
  geom_point(data=data1MAxAgg, aes(x=MaxVolume_MaxAge_mean, y=maxAge_mean, color=as.factor(LevelWD))) +
  geom_errorbar(data=data1MAxAgg, aes(x=MaxVolume_MaxAge_mean, ymin=maxAge_mean-sdmaxAge,ymax=maxAge_mean+sdmaxAge,color=as.factor(LevelWD)),width=0) +
  geom_errorbar(data=data1MAxAgg, aes(xmin=MaxVolume_MaxAge_mean-sdMaxVolume_MaxAge,xmax= MaxVolume_MaxAge_mean+sdMaxVolume_MaxAge , y=maxAge_mean,color=as.factor(LevelWD)),width=0) +
  scale_color_manual(labels = c("300 kgC m-3","600 kgC m-3", "800 kgC m-3"),values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(col="Levels of WD",x = expression(paste("Growth rate (Volume ",age^-1,  ") ")), y = "Longevity") +  
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  facet_wrap(~ Mortality, ncol=3)

ggplot() + 
  geom_point(data=data1MAxAgg, aes(x=MaxDBH_MaxAge_mean, y=maxAge_mean, color=as.factor(LevelWD))) +
  geom_errorbar(data=data1MAxAgg, aes(x=MaxDBH_MaxAge_mean, ymin=maxAge_mean-sdmaxAge,ymax=maxAge_mean+sdmaxAge,color=as.factor(LevelWD)),width=0) +
  geom_errorbar(data=data1MAxAgg, aes(xmin=MaxDBH_MaxAge_mean-sdMaxDBH_MaxAge,xmax= MaxDBH_MaxAge_mean+sdMaxDBH_MaxAge , y=maxAge_mean,color=as.factor(LevelWD)),width=0) +
  scale_color_manual(labels = c("300 kgC m-3","600 kgC m-3", "800 kgC m-3"),values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(col="Levels of WD",x = expression(paste("Growth rate (DBH ",age^-1,  ") ")), y = "Longevity") +  
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  facet_wrap(~ Mortality, ncol=3)

```

##### Rhoot:Shoot ratio with Age max 
##### Different species at a given site: Each point is one species (differing by wood density, root:shoot ratio). Add info either by using color ~site (given LUE, growing season length, PAR).

```{r, fig.width = 8, fig.height = 4}

ea1sb1ma_out_annual_tileMaxAgg <- ea1sb1ma_out_annual_tile[500:1500,] %>% summarise(maxAge_mean=mean(MaxAge,na.rm=T), sdmaxAge=sd(MaxAge,na.rm=T),
                                  MaxVolume_MaxAge_mean=mean(MaxVolume_MaxAge,na.rm=T), sdMaxVolume_MaxAge=sd(MaxVolume_MaxAge,na.rm=T),
                                  MaxDBH_MaxAge_mean=mean(MaxDBH_MaxAge,na.rm=T), sdMaxDBH_MaxAge=sd(MaxDBH_MaxAge,na.rm=T))
ea1sb2ma_out_annual_tileMaxAgg <- ea1sb2ma_out_annual_tile[500:1500,] %>% summarise(maxAge_mean=mean(MaxAge,na.rm=T), sdmaxAge=sd(MaxAge,na.rm=T),
                                  MaxVolume_MaxAge_mean=mean(MaxVolume_MaxAge,na.rm=T), sdMaxVolume_MaxAge=sd(MaxVolume_MaxAge,na.rm=T),
                                  MaxDBH_MaxAge_mean=mean(MaxDBH_MaxAge,na.rm=T), sdMaxDBH_MaxAge=sd(MaxDBH_MaxAge,na.rm=T))
ea1sb3ma_out_annual_tileMaxAgg <- ea1sb3ma_out_annual_tile[500:1500,] %>% summarise(maxAge_mean=mean(MaxAge,na.rm=T), sdmaxAge=sd(MaxAge,na.rm=T),
                                  MaxVolume_MaxAge_mean=mean(MaxVolume_MaxAge,na.rm=T), sdMaxVolume_MaxAge=sd(MaxVolume_MaxAge,na.rm=T),
                                  MaxDBH_MaxAge_mean=mean(MaxDBH_MaxAge,na.rm=T), sdMaxDBH_MaxAge=sd(MaxDBH_MaxAge,na.rm=T))
# Volume/Age
ggplot() + 
  geom_point(data=ea1sb1ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, y=maxAge_mean, color='phiRL = 4')) + geom_errorbar(data=ea1sb1ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, ymin=maxAge_mean-sdmaxAge,ymax= maxAge_mean+sdmaxAge,color='phiRL = 4'),width=0)+ 
  geom_errorbar(data=ea1sb1ma_out_annual_tileMaxAgg, aes(xmin=MaxVolume_MaxAge_mean-sdMaxVolume_MaxAge,xmax= MaxVolume_MaxAge_mean+sdMaxVolume_MaxAge , y=maxAge_mean,color='phiRL = 4'),width=0)+
  geom_point(data=ea1sb2ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, y=maxAge_mean, color='phiRL = 6')) + 
  geom_errorbar(data=ea1sb2ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, ymin=maxAge_mean-sdmaxAge,ymax= maxAge_mean+sdmaxAge,color='phiRL = 6'),width=0)+ geom_errorbar(data=ea1sb2ma_out_annual_tileMaxAgg, aes(xmin=MaxVolume_MaxAge_mean-sdMaxVolume_MaxAge,xmax= MaxVolume_MaxAge_mean+sdMaxVolume_MaxAge , y=maxAge_mean,color='phiRL = 6'),width=0)+
geom_point(data=ea1sb3ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, y=maxAge_mean, color='phiRL = 8')) + 
  geom_errorbar(data=ea1sb3ma_out_annual_tileMaxAgg, aes(x=MaxVolume_MaxAge_mean, ymin=maxAge_mean-sdmaxAge,ymax=maxAge_mean+sdmaxAge,color='phiRL = 8'),width=0) +
  geom_errorbar(data=ea1sb3ma_out_annual_tileMaxAgg, aes(xmin=MaxVolume_MaxAge_mean-sdMaxVolume_MaxAge,xmax= MaxVolume_MaxAge_mean+sdMaxVolume_MaxAge , y=maxAge_mean,color='phiRL = 8'),width=0)+
  scale_color_manual("Levels of R:S at LUE 1", breaks = c("phiRL = 4", "phiRL = 6", "phiRL = 8"), values = c("#00AFBB" ,"#E7B800", "#FC4E07"))+
  labs(x = expression(paste("Growth rate (Volume ",age^-1,  ") ")), y = "Longevity") +  
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  scale_x_continuous(limits = c(0,1.75),breaks = seq(0,1.75,0.25)) + scale_y_continuous(limits = c(275, 450),breaks = seq(275, 450, 25))

# Facet wrap
data1 <- rbind(ea1sb1ma_out_annual_tile, ea1sb2ma_out_annual_tile, ea1sb3ma_out_annual_tile,
               ea1sb1mb_out_annual_tile, ea1sb2mb_out_annual_tile, ea1sb3mb_out_annual_tile,
               ea1sb1mc_out_annual_tile, ea1sb2mc_out_annual_tile, ea1sb3mc_out_annual_tile)

data1$Mortality <- factor(data1$Mortality, levels = c("DBH", "NSC/Leaf mass", "Growth rate"))

data1MAxAgg <- data1 %>% filter(year>=1300) %>% group_by(Mortality,LevelRS) %>% summarise(maxAge_mean=mean(MaxAge,na.rm=T), sdmaxAge=sd(MaxAge,na.rm=T),
                                  MaxVolume_MaxAge_mean=mean(MaxVolume_MaxAge,na.rm=T), sdMaxVolume_MaxAge=sd(MaxVolume_MaxAge,na.rm=T),
                                  MaxDBH_MaxAge_mean=mean(MaxDBH_MaxAge,na.rm=T), sdMaxDBH_MaxAge=sd(MaxDBH_MaxAge,na.rm=T))
 
ggplot() + 
  geom_point(data=data1MAxAgg, aes(x=MaxVolume_MaxAge_mean, y=maxAge_mean, color=as.factor(LevelRS))) +
  geom_errorbar(data=data1MAxAgg, aes(x=MaxVolume_MaxAge_mean, ymin=maxAge_mean-sdmaxAge,ymax=maxAge_mean+sdmaxAge,color=as.factor(LevelRS)),width=0) +
  geom_errorbar(data=data1MAxAgg, aes(xmin=MaxVolume_MaxAge_mean-sdMaxVolume_MaxAge,xmax= MaxVolume_MaxAge_mean+sdMaxVolume_MaxAge , y=maxAge_mean,color=as.factor(LevelRS)),width=0) +
  scale_color_manual(labels = c("phiRL = 4", "phiRL = 6", "phiRL = 8"),values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(col="Levels of RS",x = expression(paste("Growth rate (Volume ",age^-1,  ") ")), y = "Longevity") +  
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  facet_wrap(~ Mortality, ncol=3)

ggplot() + 
  geom_point(data=data1MAxAgg, aes(x=MaxDBH_MaxAge_mean, y=maxAge_mean, color=as.factor(LevelRS))) +
  geom_errorbar(data=data1MAxAgg, aes(x=MaxDBH_MaxAge_mean, ymin=maxAge_mean-sdmaxAge,ymax=maxAge_mean+sdmaxAge,color=as.factor(LevelRS)),width=0) +
  geom_errorbar(data=data1MAxAgg, aes(xmin=MaxDBH_MaxAge_mean-sdMaxDBH_MaxAge,xmax= MaxDBH_MaxAge_mean+sdMaxDBH_MaxAge , y=maxAge_mean,color=as.factor(LevelRS)),width=0) +
  scale_color_manual(labels = c("phiRL = 4", "phiRL = 6", "phiRL = 8"),values = c("#00AFBB", "#E7B800", "#FC4E07"))+
  labs(col="Levels of RS",x = expression(paste("Growth rate (DBH ",age^-1,  ") ")), y = "Longevity") +  
  theme_bw() + theme(panel.grid.major = element_blank(), panel.grid.minor = element_blank(),legend.position = "bottom")+
  facet_wrap(~ Mortality, ncol=3)

```

